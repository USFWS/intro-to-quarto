!function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n;n||(n=1,function(){function e(e){var t=!0,n=!1,o=null,i={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function r(e){return!!(e&&e!==document&&"HTML"!==e.nodeName&&"BODY"!==e.nodeName&&"classList"in e&&"contains"in e.classList)}function s(e){var t=e.type,n=e.tagName;return!("INPUT"!==n||!i[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}function a(e){e.classList.contains("focus-visible")||(e.classList.add("focus-visible"),e.setAttribute("data-focus-visible-added",""))}function l(e){e.hasAttribute("data-focus-visible-added")&&(e.classList.remove("focus-visible"),e.removeAttribute("data-focus-visible-added"))}function c(n){
n.metaKey||n.altKey||n.ctrlKey||(r(e.activeElement)&&a(e.activeElement),t=!0)}function d(e){t=!1}function u(e){r(e.target)&&(t||s(e.target))&&a(e.target)}function h(e){r(e.target)&&(e.target.classList.contains("focus-visible")||e.target.hasAttribute("data-focus-visible-added"))&&(n=!0,window.clearTimeout(o),o=window.setTimeout((function(){n=!1}),100),l(e.target))}function f(e){"hidden"===document.visibilityState&&(n&&(t=!0),m())}function m(){document.addEventListener("mousemove",p),document.addEventListener("mousedown",p),document.addEventListener("mouseup",p),document.addEventListener("pointermove",p),document.addEventListener("pointerdown",p),document.addEventListener("pointerup",p),document.addEventListener("touchmove",p),document.addEventListener("touchstart",p),document.addEventListener("touchend",p)}function g(){document.removeEventListener("mousemove",p),document.removeEventListener("mousedown",p),document.removeEventListener("mouseup",p),document.removeEventListener("pointermove",p),
document.removeEventListener("pointerdown",p),document.removeEventListener("pointerup",p),document.removeEventListener("touchmove",p),document.removeEventListener("touchstart",p),document.removeEventListener("touchend",p)}function p(e){e.target.nodeName&&"html"===e.target.nodeName.toLowerCase()||(t=!1,g())}document.addEventListener("keydown",c,!0),document.addEventListener("mousedown",d,!0),document.addEventListener("pointerdown",d,!0),document.addEventListener("touchstart",d,!0),document.addEventListener("visibilitychange",f,!0),m(),e.addEventListener("focus",u,!0),e.addEventListener("blur",h,!0),e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&e.host?e.host.setAttribute("data-js-focus-visible",""):e.nodeType===Node.DOCUMENT_NODE&&(document.documentElement.classList.add("js-focus-visible"),document.documentElement.setAttribute("data-js-focus-visible",""))}if("undefined"!=typeof window&&"undefined"!=typeof document){var t;window.applyFocusVisiblePolyfill=e;try{t=new CustomEvent("focus-visible-polyfill-ready")
}catch(e){(t=document.createEvent("CustomEvent")).initCustomEvent("focus-visible-polyfill-ready",!1,!1,{})}window.dispatchEvent(t)}"undefined"!=typeof document&&e(document)}());var o,i,r,s,a,l,c,d,u,h,f,m,g={},p=[],_=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,b=Array.isArray;function w(e,t){for(var n in t)e[n]=t[n];return e}function v(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function y(e,t,n,o,s){var a={type:e,props:t,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==s?++r:s,__i:-1,__u:0};return null==s&&null!=i.vnode&&i.vnode(a),a}function x(e){return e.children}function N(e,t){this.props=e,this.context=t}function C(e,t){if(null==t)return e.__?C(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?C(e):null}function S(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break
}return S(e)}}function E(e){(!e.__d&&(e.__d=!0)&&s.push(e)&&!k.__r++||a!==i.debounceRendering)&&((a=i.debounceRendering)||l)(k)}function k(){var e,t,n,o,r,a,l,d;for(s.sort(c);e=s.shift();)e.__d&&(t=s.length,o=void 0,a=(r=(n=e).__v).__e,l=[],d=[],n.__P&&((o=w({},r)).__v=r.__v+1,i.vnode&&i.vnode(o),M(n.__P,o,r,n.__n,n.__P.namespaceURI,32&r.__u?[a]:null,l,null==a?C(r):a,!!(32&r.__u),d),o.__v=r.__v,o.__.__k[o.__i]=o,I(l,o,d),o.__e!=a&&S(o)),s.length>t&&s.sort(c));k.__r=0}function A(e,t,n,o,i,r,s,a,l,c,d){var u,h,f,m,_,w,v=o&&o.__k||p,N=t.length;for(l=function(e,t,n,o,i){var r,s,a,l,c,d=n.length,u=d,h=0;for(e.__k=new Array(i),r=0;r<i;r++)null!=(s=t[r])&&"boolean"!=typeof s&&"function"!=typeof s?(l=r+h,(s=e.__k[r]="string"==typeof s||"number"==typeof s||"bigint"==typeof s||s.constructor==String?y(null,s,null,null,null):b(s)?y(x,{children:s},null,null,null):void 0===s.constructor&&s.__b>0?y(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s).__=e,s.__b=e.__b+1,a=null,-1!==(c=s.__i=P(s,n,l,u))&&(u--,
(a=n[c])&&(a.__u|=2)),null==a||null===a.__v?(-1==c&&h--,"function"!=typeof s.type&&(s.__u|=4)):c!=l&&(c==l-1?h--:c==l+1?h++:(c>l?h--:h++,s.__u|=4))):e.__k[r]=null;if(u)for(r=0;r<d;r++)null!=(a=n[r])&&0==(2&a.__u)&&(a.__e==o&&(o=C(a)),D(a,a));return o}(n,t,v,l,N),u=0;u<N;u++)null!=(f=n.__k[u])&&(h=-1===f.__i?g:v[f.__i]||g,f.__i=u,w=M(e,f,h,i,r,s,a,l,c,d),m=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&F(h.ref,null,f),d.push(f.ref,f.__c||m,f)),null==_&&null!=m&&(_=m),4&f.__u||h.__k===f.__k?l=R(f,l,e):"function"==typeof f.type&&void 0!==w?l=w:m&&(l=m.nextSibling),f.__u&=-7);return n.__e=_,l}function R(e,t,n){var o,i;if("function"==typeof e.type){for(o=e.__k,i=0;o&&i<o.length;i++)o[i]&&(o[i].__=e,t=R(o[i],t,n));return t}e.__e!=t&&(t&&e.type&&!n.contains(t)&&(t=C(e)),n.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function P(e,t,n,o){var i,r,s=e.key,a=e.type,l=t[n];if(null===l||l&&s==l.key&&a===l.type&&0==(2&l.__u))return n;if(o>(null!=l&&0==(2&l.__u)?1:0))for(i=n-1,
r=n+1;i>=0||r<t.length;){if(i>=0){if((l=t[i])&&0==(2&l.__u)&&s==l.key&&a===l.type)return i;i--}if(r<t.length){if((l=t[r])&&0==(2&l.__u)&&s==l.key&&a===l.type)return r;r++}}return-1}function T(e,t,n){"-"==t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||_.test(t)?n:n+"px"}function O(e,t,n,o,i){var r;e:if("style"==t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof o&&(e.style.cssText=o=""),o)for(t in o)n&&t in n||T(e.style,t,"");if(n)for(t in n)o&&n[t]===o[t]||T(e.style,t,n[t])}else if("o"==t[0]&&"n"==t[1])r=t!=(t=t.replace(d,"$1")),t=t.toLowerCase()in e||"onFocusOut"==t||"onFocusIn"==t?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?o?n.u=o.u:(n.u=u,e.addEventListener(t,r?f:h,r)):e.removeEventListener(t,r?f:h,r);else{
if("http://www.w3.org/2000/svg"==i)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==n?"":n))}}function L(e){return function(t){if(this.l){var n=this.l[t.type+e];if(null==t.t)t.t=u++;else if(t.t<n.u)return;return n(i.event?i.event(t):t)}}}function M(e,t,n,o,r,s,a,l,c,d){var u,h,f,m,g,p,_,y,C,S,E,k,R,P,T,O,L,M=t.type;if(void 0!==t.constructor)return null;128&n.__u&&(c=!!(32&n.__u),s=[l=t.__e=n.__e]),(u=i.__b)&&u(t);e:if("function"==typeof M)try{if(y=t.props,C="prototype"in M&&M.prototype.render,S=(u=M.contextType)&&o[u.__c],E=u?S?S.props.value:u.__:o,n.__c?_=(h=t.__c=n.__c).__=h.__E:(C?t.__c=h=new M(y,E):(t.__c=h=new N(y,E),h.constructor=M,h.render=H),S&&S.sub(h),h.props=y,h.state||(h.state={}),h.context=E,
h.__n=o,f=h.__d=!0,h.__h=[],h._sb=[]),C&&null==h.__s&&(h.__s=h.state),C&&null!=M.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=w({},h.__s)),w(h.__s,M.getDerivedStateFromProps(y,h.__s))),m=h.props,g=h.state,h.__v=t,f)C&&null==M.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),C&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(C&&null==M.getDerivedStateFromProps&&y!==m&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(y,E),!h.__e&&(null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(y,h.__s,E)||t.__v==n.__v)){for(t.__v!=n.__v&&(h.props=y,h.state=h.__s,h.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some((function(e){e&&(e.__=t)})),k=0;k<h._sb.length;k++)h.__h.push(h._sb[k]);h._sb=[],h.__h.length&&a.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(y,h.__s,E),C&&null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(m,g,p)}))}if(h.context=E,h.props=y,h.__P=e,h.__e=!1,R=i.__r,P=0,C){for(h.state=h.__s,h.__d=!1,
R&&R(t),u=h.render(h.props,h.state,h.context),T=0;T<h._sb.length;T++)h.__h.push(h._sb[T]);h._sb=[]}else do{h.__d=!1,R&&R(t),u=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++P<25);h.state=h.__s,null!=h.getChildContext&&(o=w(w({},o),h.getChildContext())),C&&!f&&null!=h.getSnapshotBeforeUpdate&&(p=h.getSnapshotBeforeUpdate(m,g)),l=A(e,b(O=null!=u&&u.type===x&&null==u.key?u.props.children:u)?O:[O],t,n,o,r,s,a,l,c,d),h.base=t.__e,t.__u&=-161,h.__h.length&&a.push(h),_&&(h.__E=h.__=null)}catch(e){if(t.__v=null,c||null!=s)if(e.then){for(t.__u|=c?160:128;l&&8==l.nodeType&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,t.__e=l}else for(L=s.length;L--;)v(s[L]);else t.__e=n.__e,t.__k=n.__k;i.__e(e,t,n)}else null==s&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):l=t.__e=B(n.__e,t,n,o,r,s,a,c,d);return(u=i.diffed)&&u(t),128&t.__u?void 0:l}function I(e,t,n){for(var o=0;o<n.length;o++)F(n[o],n[++o],n[++o]);i.__c&&i.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){
i.__e(e,t.__v)}}))}function B(e,t,n,r,s,a,l,c,d){var u,h,f,m,p,_,w,y=n.props,x=t.props,N=t.type;if("svg"==N?s="http://www.w3.org/2000/svg":"math"==N?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),null!=a)for(u=0;u<a.length;u++)if((p=a[u])&&"setAttribute"in p==!!N&&(N?p.localName==N:3==p.nodeType)){e=p,a[u]=null;break}if(null==e){if(null==N)return document.createTextNode(x);e=document.createElementNS(s,N,x.is&&x),c&&(i.__m&&i.__m(t,a),c=!1),a=null}if(null===N)y===x||c&&e.data===x||(e.data=x);else{if(a=a&&o.call(e.childNodes),y=n.props||g,!c&&null!=a)for(y={},u=0;u<e.attributes.length;u++)y[(p=e.attributes[u]).name]=p.value;for(u in y)if(p=y[u],"children"==u);else if("dangerouslySetInnerHTML"==u)f=p;else if(!(u in x)){if("value"==u&&"defaultValue"in x||"checked"==u&&"defaultChecked"in x)continue;O(e,u,null,p,s)}for(u in x)p=x[u],"children"==u?m=p:"dangerouslySetInnerHTML"==u?h=p:"value"==u?_=p:"checked"==u?w=p:c&&"function"!=typeof p||y[u]===p||O(e,u,p,y[u],s)
;if(h)c||f&&(h.__html===f.__html||h.__html===e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(f&&(e.innerHTML=""),A(e,b(m)?m:[m],t,n,r,"foreignObject"==N?"http://www.w3.org/1999/xhtml":s,a,l,a?a[0]:n.__k&&C(n,0),c,d),null!=a)for(u=a.length;u--;)v(a[u]);c||(u="value","progress"==N&&null==_?e.removeAttribute("value"):void 0!==_&&(_!==e[u]||"progress"==N&&!_||"option"==N&&_!==y[u])&&O(e,u,_,y[u],s),u="checked",void 0!==w&&w!==e[u]&&O(e,u,w,y[u],s))}return e}function F(e,t,n){try{if("function"==typeof e){var o="function"==typeof e.__u;o&&e.__u(),o&&null==t||(e.__u=e(t))}else e.current=t}catch(e){i.__e(e,n)}}function D(e,t,n){var o,r;if(i.unmount&&i.unmount(e),(o=e.ref)&&(o.current&&o.current!==e.__e||F(o,null,t)),null!=(o=e.__c)){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(e){i.__e(e,t)}o.base=o.__P=null}if(o=e.__k)for(r=0;r<o.length;r++)o[r]&&D(o[r],t,n||"function"!=typeof e.type);n||v(e.__e),e.__c=e.__=e.__e=void 0}function H(e,t,n){return this.constructor(e,n)}function V(e,t,n){var r,s,a
;t==document&&(t=document.documentElement),i.__&&i.__(e,t),r=!1?null:t.__k,s=[],a=[],M(t,e=t.__k=function(e,t,n){var i,r,s,a={};for(s in t)"key"==s?i=t[s]:"ref"==s?r=t[s]:a[s]=t[s];if(arguments.length>2&&(a.children=arguments.length>3?o.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===a[s]&&(a[s]=e.defaultProps[s]);return y(e,a,i,r,null)}(x,null,[e]),r||g,g,t.namespaceURI,r?null:t.firstChild?o.call(t.childNodes):null,s,r?r.__e:t.firstChild,false,a),I(s,e,a)}function U(e,t){var n={__c:t="__cC"+m++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var n,o;return this.getChildContext||(n=new Set,(o={})[t]=this,this.getChildContext=function(){return o},this.componentWillUnmount=function(){n=null},this.shouldComponentUpdate=function(e){this.props.value!==e.value&&n.forEach((function(e){e.__e=!0,E(e)}))},this.sub=function(e){n.add(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){n&&n.delete(e),t&&t.call(e)}}),e.children}}
;return n.Provider.__=n.Consumer.contextType=n}o=p.slice,i={__e:function(e,t,n,o){for(var i,r,s;t=t.__;)if((i=t.__c)&&!i.__)try{if((r=i.constructor)&&null!=r.getDerivedStateFromError&&(i.setState(r.getDerivedStateFromError(e)),s=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(e,o||{}),s=i.__d),s)return i.__E=i}catch(t){e=t}throw e}},r=0,N.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=w({},this.state),"function"==typeof e&&(e=e(w({},n),this.props)),e&&w(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),E(this))},N.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),E(this))},N.prototype.render=x,s=[],l="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,c=function(e,t){return e.__v.__b-t.__v.__b},k.__r=0,d=/(PointerCapture)$|Capture$/i,u=0,h=L(!1),f=L(!0),m=0;var q,$,W,z,j=0,X=[],K=i,Q=K.__b,G=K.__r,Y=K.diffed,J=K.__c,Z=K.unmount,ee=K.__;function te(e,t){K.__h&&K.__h($,e,j||t),j=0
;var n=$.__H||($.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function ne(e){return j=1,function(e,t,n){var o=te(q++,2);if(o.t=e,!o.__c&&(o.__=[pe(void 0,t),function(e){var t=o.__N?o.__N[0]:o.__[0],n=o.t(t,e);t!==n&&(o.__N=[n,o.__[1]],o.__c.setState({}))}],o.__c=$,!$.u)){var i=function(e,t,n){if(!o.__c.__H)return!0;var i=o.__c.__H.__.filter((function(e){return!!e.__c}));if(i.every((function(e){return!e.__N})))return!r||r.call(this,e,t,n);var s=o.__c.props!==e;return i.forEach((function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(s=!0)}})),r&&r.call(this,e,t,n)||s};$.u=!0;var r=$.shouldComponentUpdate,s=$.componentWillUpdate;$.componentWillUpdate=function(e,t,n){if(this.__e){var o=r;r=void 0,i(e,t,n),r=o}s&&s.call(this,e,t,n)},$.shouldComponentUpdate=i}return o.__N||o.__}(pe,e)}function oe(e,t){var n=te(q++,3);!K.__s&&ge(n.__H,t)&&(n.__=e,n.i=t,$.__H.__h.push(n))}function ie(e,t){var n=te(q++,4);!K.__s&&ge(n.__H,t)&&(n.__=e,n.i=t,$.__h.push(n))}function re(e){
return j=5,se((function(){return{current:e}}),[])}function se(e,t){var n=te(q++,7);return ge(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function ae(e,t){return j=8,se((function(){return e}),t)}function le(e){var t=$.context[e.__c],n=te(q++,9);return n.c=e,t?(null==n.__&&(n.__=!0,t.sub($)),t.props.value):e.__}function ce(){var e=te(q++,11);if(!e.__){for(var t=$.__v;null!==t&&!t.__m&&null!==t.__;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__}function de(){for(var e;e=X.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(fe),e.__H.__h.forEach(me),e.__H.__h=[]}catch(t){e.__H.__h=[],K.__e(t,e.__v)}}K.__b=function(e){$=null,Q&&Q(e)},K.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),ee&&ee(e,t)},K.__r=function(e){G&&G(e),q=0;var t=($=e.__c).__H;t&&(W===$?(t.__h=[],$.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.i=e.__N=void 0}))):(t.__h.forEach(fe),t.__h.forEach(me),t.__h=[],q=0)),W=$},K.diffed=function(e){Y&&Y(e);var t=e.__c
;t&&t.__H&&(t.__H.__h.length&&(1!==X.push(t)&&z===K.requestAnimationFrame||((z=K.requestAnimationFrame)||he)(de)),t.__H.__.forEach((function(e){e.i&&(e.__H=e.i),e.i=void 0}))),W=$=null},K.__c=function(e,t){t.some((function(e){try{e.__h.forEach(fe),e.__h=e.__h.filter((function(e){return!e.__||me(e)}))}catch(n){t.some((function(e){e.__h&&(e.__h=[])})),t=[],K.__e(n,e.__v)}})),J&&J(e,t)},K.unmount=function(e){Z&&Z(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach((function(e){try{fe(e)}catch(e){t=e}})),n.__H=void 0,t&&K.__e(t,n.__v))};var ue="function"==typeof requestAnimationFrame;function he(e){var t,n=function(){clearTimeout(o),ue&&cancelAnimationFrame(t),setTimeout(e)},o=setTimeout(n,100);ue&&(t=requestAnimationFrame(n))}function fe(e){var t=$,n=e.__c;"function"==typeof n&&(e.__c=void 0,n()),$=t}function me(e){var t=$;e.__c=e.__(),$=t}function ge(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function pe(e,t){return"function"==typeof t?t(e):t}function _e(e,t,n){return(t=function(e){
var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class be{constructor(){_e(this,"_listeners",void 0),this._listeners=new Map}add(e,t,n,o){e.addEventListener(t,n,o);const i=Symbol();return this._listeners.set(i,{eventTarget:e,eventType:t,listener:n,options:o}),i}remove(e){const t=this._listeners.get(e);if(t){const{eventTarget:n,eventType:o,listener:i,options:r}=t;n.removeEventListener(o,i,r),this._listeners.delete(e)}}removeAll(){this._listeners.forEach((({eventTarget:e,eventType:t,listener:n,options:o})=>{e.removeEventListener(t,n,o)})),this._listeners.clear()}}function we(e){e.focus()}
function ve(e,{autofocus:t=!1,loop:n=!0,horizontal:o=!0,vertical:i=!0,selector:r="a,button",containerVisible:s=!0,focusElement:a=we}={}){const l=re(null),c=function(e){const t=re({callback:e,call:(...e)=>t.current.callback(...e)});return t.current.callback=e,t.current.call}(a);oe((()=>{if(!s)return()=>{};if(!e.current)throw new Error("Container ref not set");const a=e.current,d=()=>{const e=Array.from(a.querySelectorAll(r)).filter((e=>null!==e.offsetParent&&!function(e){return"boolean"==typeof e.disabled&&e.disabled}(e)));return document.activeElement===a&&e.unshift(a),e},u=(e=d(),t=-1,n=!1,o)=>{t<0&&(t=e.findIndex((e=>0===e.tabIndex)))<0&&(t=0);for(const[i,r]of e.entries())r.tabIndex=i===t?0:-1,i===t&&n&&(l.current=r,c(r,o))},h=d(),f=l.current?h.indexOf(l.current):0;u(h,f,t);const m=new be;m.add(a,"focusin",(e=>{if(e.target===a&&l.current)return void c(l.current);const n=d(),o=n.indexOf(e.target);o>=0&&u(n,o,t)})),m.add(a,"keydown",(e=>{const t=d();let r=t.findIndex((e=>0===e.tabIndex)),s=!1
;o&&"ArrowLeft"===e.key||i&&"ArrowUp"===e.key?(0===r?r=n?t.length-1:r:--r,s=!0):o&&"ArrowRight"===e.key||i&&"ArrowDown"===e.key?(r===t.length-1?r=n?0:r:++r,s=!0):"Home"===e.key?(r=0,s=!0):"End"===e.key&&(r=t.length-1,s=!0),s&&(u(t,r,!0,e),e.preventDefault(),e.stopPropagation())}));const g=new MutationObserver((()=>{u()}));return g.observe(a,{subtree:!0,attributes:!0,attributeFilter:["disabled"],childList:!0}),()=>{m.removeAll(),g.disconnect()}}),[t,e,c,o,n,r,i,s])}function ye(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class xe{constructor(e){ye(this,"_target",void 0),ye(this,"_value",void 0),this._target=e,this._value=null}
get current(){return this._value}set current(e){this._value=e,this._updateTarget()}get target(){return this._target}set target(e){e!==this._target&&(this._target=e,this._updateTarget())}_updateTarget(){const e=this._value;"function"==typeof this._target?this._target(e):this._target&&(this._target.current=e)}}function Ne(e){const t=re(new xe(e));return t.current.target=e,t.current}var Ce,Se={exports:{}};var Ee,ke=(Ce||(Ce=1,Ee=Se,function(){var e={}.hasOwnProperty;function t(){for(var e="",t=0;t<arguments.length;t++){var i=arguments[t];i&&(e=o(e,n(i)))}return e}function n(n){if("string"==typeof n||"number"==typeof n)return n;if("object"!=typeof n)return"";if(Array.isArray(n))return t.apply(null,n);if(n.toString!==Object.prototype.toString&&!n.toString.toString().includes("[native code]"))return n.toString();var i="";for(var r in n)e.call(n,r)&&n[r]&&(i=o(i,r));return i}function o(e,t){return t?e?e+" "+t:e+t:e}Ee.exports?(t.default=t,Ee.exports=t):window.classNames=t}()),Se.exports),Ae=t(ke);var Re=0
;function Pe(e,t,n,o,r,s){t||(t={});var a,l,c=t;if("ref"in c)for(l in c={},t)"ref"==l?a=t[l]:c[l]=t[l];var d={type:e,props:c,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Re,__i:-1,__u:0,__source:r,__self:s};if("function"==typeof e&&(a=e.defaultProps))for(l in a)void 0===c[l]&&(c[l]=a[l]);return i.vnode&&i.vnode(d),d}U({}),U({});var Te="/home/runner/work/frontend-shared/frontend-shared/src/components/layout/Card.tsx";function Oe({children:e,classes:t,elementRef:n,active:o=!1,variant:i="raised",width:r="full",...s}){return Pe("div",{"data-component":"Card",...s,ref:n,className:Ae("rounded-lg border bg-white",{"shadow hover:shadow-md":"raised"===i,"shadow-md":o&&"raised"===i},{"w-full":"full"===r,"w-auto":"auto"===r},t),children:e},void 0,0,{fileName:Te,lineNumber:40,columnNumber:5},this)}var Le="/home/runner/work/frontend-shared/frontend-shared/src/components/layout/CardContent.tsx";function Me({children:e,classes:t,elementRef:n,size:o="md",...i}){return Pe("div",{
"data-component":"CardContent",...i,ref:n,className:Ae({"p-3 space-y-4":"md"===o,"p-2 space-y-3":"sm"===o,"p-4 space-y-6":"lg"===o},t),children:e},void 0,0,{fileName:Le,lineNumber:29,columnNumber:5},this)}var Ie="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Annotate.tsx";function Be(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"AnnotateIcon",...e,children:Pe("path",{fill:"currentColor",
d:"M15 0q.406 0 .703.297A.96.96 0 0 1 16 1v15l-4-3H1a.97.97 0 0 1-.703-.29A.95.95 0 0 1 0 12V1A.96.96 0 0 1 .29.29.97.97 0 0 1 1 0zM7 3l-.469.063q-.468.062-1.031.437T4.469 4.688Q3.999 5.5 4 7l.002.063.006.062a1 1 0 0 1 .008.11l-.002.074-.006.066a1.45 1.45 0 0 0 .43 1.188Q4.874 9 5.5 9q.624 0 1.063-.438Q7 8.126 7 7.5q0-.624-.438-1.063A1.45 1.45 0 0 0 5.5 6a1.5 1.5 0 0 0-.422.062q.266-1.545 1.094-1.804L7 4zm5 0-.469.063q-.468.062-1.031.437T9.469 4.688Q8.999 5.5 9 7l.002.063.006.062a1 1 0 0 1 .008.11l-.002.074-.006.066a1.45 1.45 0 0 0 .43 1.188Q9.874 9 10.5 9q.624 0 1.063-.438Q12 8.125 12 7.5t-.438-1.063A1.45 1.45 0 0 0 10.5 6a1.5 1.5 0 0 0-.422.062q.266-1.545 1.094-1.804L12 4z"},void 0,0,{fileName:Ie,lineNumber:19,columnNumber:7},this)},void 0,0,{fileName:Ie,lineNumber:11,columnNumber:5},this)}var Fe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Cancel.tsx";function De(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",
viewBox:"0 0 16 16","data-component":"CancelIcon",...e,children:Pe("g",{fill:"none","fill-rule":"evenodd",children:[Pe("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Fe,lineNumber:21,columnNumber:9},this),Pe("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m8 8 3.536-3.536zL4.464 4.464zm0 0-3.536 3.536zl3.536 3.536z"},void 0,0,{fileName:Fe,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Fe,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Fe,lineNumber:11,columnNumber:5},this)}var He="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretDown.tsx";function Ve(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretDownIcon",...e,children:Pe("g",{fill:"none","fill-rule":"evenodd",children:[Pe("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:He,lineNumber:21,columnNumber:9},this),Pe("path",{stroke:"currentColor","stroke-linecap":"round",
"stroke-linejoin":"round","stroke-width":"2",d:"m12 6-4 4-4-4"},void 0,0,{fileName:He,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:He,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:He,lineNumber:11,columnNumber:5},this)}var Ue="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretLeft.tsx";function qe(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretLeftIcon",...e,children:Pe("g",{fill:"none","fill-rule":"evenodd",children:[Pe("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Ue,lineNumber:21,columnNumber:9},this),Pe("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 12 6 8l4-4"},void 0,0,{fileName:Ue,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:Ue,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:Ue,lineNumber:11,columnNumber:5},this)}
var $e="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CaretRight.tsx";function We(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"CaretRightIcon",...e,children:Pe("g",{fill:"none","fill-rule":"evenodd",children:[Pe("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:$e,lineNumber:21,columnNumber:9},this),Pe("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m6 4 4 4-4 4"},void 0,0,{fileName:$e,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:$e,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:$e,lineNumber:11,columnNumber:5},this)}var ze="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Caution.tsx";function je(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",viewBox:"0 0 24 24",
"data-component":"CautionIcon",...e,children:Pe("path",{d:"M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0M12 9v4M12 17h.01"},void 0,0,{fileName:ze,lineNumber:24,columnNumber:7},this)},void 0,0,{fileName:ze,lineNumber:11,columnNumber:5},this)}var Xe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Check.tsx";function Ke(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"CheckIcon",...e,children:Pe("g",{fill:"none","fill-rule":"evenodd",children:[Pe("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:Xe,lineNumber:20,columnNumber:9},this),Pe("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 3 6 13 3 8"},void 0,0,{fileName:Xe,lineNumber:21,columnNumber:9},this)]},void 0,0,{fileName:Xe,lineNumber:19,columnNumber:7},this)},void 0,0,{fileName:Xe,lineNumber:11,columnNumber:5},this)}
var Qe="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CheckboxChecked.tsx";function Ge(e){return Pe("svg",{width:"16",height:"16","aria-hidden":"true",viewBox:"-4 -4 39 39","data-component":"CheckboxCheckedIcon",...e,children:[Pe("rect",{width:"35",height:"35",x:"-2",y:"-2",fill:"none",stroke:"currentColor","stroke-width":"3",rx:"5",ry:"5"},void 0,0,{fileName:Qe,lineNumber:19,columnNumber:7},this),Pe("path",{fill:"none",stroke:"currentColor","stroke-width":"5",d:"m4 14 8 9L28 5"},void 0,0,{fileName:Qe,lineNumber:30,columnNumber:7},this)]},void 0,0,{fileName:Qe,lineNumber:11,columnNumber:5},this)}var Ye="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CheckboxCheckedFilled.tsx";function Je(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",viewBox:"0 0 16 16","data-component":"CheckboxCheckedFilledIcon",...e,children:[Pe("rect",{width:"16",height:"16",fill:"currentColor",rx:"4"},void 0,0,{fileName:Ye,lineNumber:22,
columnNumber:7},this),Pe("path",{fill:"#fff",d:"M11.136 3.82a.75.75 0 0 1 1.278.78l-.05.08-5.25 7.5a.75.75 0 0 1-1.204.033l-.053-.077-2.25-3.75a.75.75 0 0 1 1.237-.844l.05.072 1.654 2.758z"},void 0,0,{fileName:Ye,lineNumber:23,columnNumber:7},this)]},void 0,0,{fileName:Ye,lineNumber:13,columnNumber:5},this)}var Ze="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/CheckboxOutline.tsx";function et(e){return Pe("svg",{width:"16",height:"16","aria-hidden":"true",viewBox:"-4 -4 39 39","data-component":"CheckboxOutlineIcon",...e,children:Pe("rect",{width:"35",height:"35",x:"-2",y:"-2",fill:"none",stroke:"currentColor","stroke-width":"3",rx:"5",ry:"5"},void 0,0,{fileName:Ze,lineNumber:19,columnNumber:7},this)},void 0,0,{fileName:Ze,lineNumber:11,columnNumber:5},this)}var tt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Hide.tsx";function nt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16",
"data-component":"HideIcon",...e,children:Pe("path",{fill:"currentColor",d:"m1.613.21.094.083 14 14a1 1 0 0 1-1.32 1.497l-.094-.083-14-14A1 1 0 0 1 1.613.21m.583 4.845a1 1 0 0 1 .292 1.384C2.165 6.935 2 7.46 2 8c0 2.123 2.628 4 6 4q.33 0 .657-.024a1 1 0 0 1 .147 1.994Q8.405 14 8 14c-4.36 0-8-2.6-8-6 0-.937.283-1.84.812-2.653a1 1 0 0 1 1.384-.292M8 2c4.36 0 8 2.6 8 6 0 .937-.283 1.84-.812 2.653a1 1 0 0 1-1.676-1.092C13.835 9.065 14 8.54 14 8c0-2.123-2.628-4-6-4q-.33 0-.657.024a1 1 0 1 1-.147-1.994Q7.595 2 8 2"},void 0,0,{fileName:tt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:tt,lineNumber:11,columnNumber:5},this)}var ot="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Highlight.tsx";function it(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"HighlightIcon",...e,children:Pe("g",{fill:"none","fill-rule":"evenodd",children:[Pe("path",{d:"M0 0h16v16H0z"},void 0,0,{fileName:ot,lineNumber:21,
columnNumber:9},this),Pe("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15H1zm-.5-6v2l-1 1v-2zm.5-7v6h-2V2zm0-1h-2zm0 8h-2z"},void 0,0,{fileName:ot,lineNumber:22,columnNumber:9},this)]},void 0,0,{fileName:ot,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:ot,lineNumber:11,columnNumber:5},this)}var rt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/MenuCollapse.tsx";function st(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","data-component":"MenuCollapseIcon",...e,children:Pe("path",{fill:"currentColor",d:"m8.54 4.205 6.23 5.87a.69.69 0 0 1 0 1.03l-.72.68a.8.8 0 0 1-1.09 0L8 7.135l-4.96 4.65a.8.8 0 0 1-1.09 0l-.73-.69a.69.69 0 0 1 0-1.02l6.24-5.87a.8.8 0 0 1 1.08 0"},void 0,0,{fileName:rt,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:rt,lineNumber:11,columnNumber:5},this)}var at="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/MenuExpand.tsx"
;function lt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","data-component":"MenuExpandIcon",...e,children:Pe("path",{fill:"currentColor",d:"M7.456 11.788 1.226 5.92a.695.695 0 0 1 0-1.025l.726-.684a.804.804 0 0 1 1.087-.001L8 8.861l4.961-4.65a.804.804 0 0 1 1.087.001l.727.684c.3.283.3.742 0 1.025l-6.23 5.867a.804.804 0 0 1-1.09 0z"},void 0,0,{fileName:at,lineNumber:19,columnNumber:7},this)},void 0,0,{fileName:at,lineNumber:11,columnNumber:5},this)}var ct="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Note.tsx";function dt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"NoteIcon",...e,children:Pe("path",{fill:"currentColor",d:"M14 0a2 2 0 0 1 1.995 1.85L16 2v7a1 1 0 0 1-.31.724l-.09.076-8 6a1 1 0 0 1-.471.192L7 16H2a2 2 0 0 1-1.995-1.85L0 14V2A2 2 0 0 1 1.85.005L2 0zm0 2H2v12h4V9a1 1 0 0 1 .883-.993L7 8h7zm-2 8H8v3z"},void 0,0,{fileName:ct,
lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:ct,lineNumber:11,columnNumber:5},this)}var ut="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/PointerDown.tsx";function ht(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"9","data-component":"PointerDownIcon",...e,children:Pe("path",{stroke:"currentColor",d:"m15.5 0-7 8-8-8"},void 0,0,{fileName:ut,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:ut,lineNumber:11,columnNumber:5},this)}var ft="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/PointerUp.tsx";function mt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"9","data-component":"PointerUpIcon",...e,children:Pe("path",{stroke:"currentColor",d:"m.5 9 7-8 8 8"},void 0,0,{fileName:ft,lineNumber:18,columnNumber:7},this)},void 0,0,{fileName:ft,lineNumber:11,columnNumber:5},this)}var gt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Radio.tsx";function pt(e){return Pe("svg",{
xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",viewBox:"0 0 16 16","data-component":"RadioIcon",...e,children:[Pe("rect",{width:"15",height:"15",x:".5",y:".5",fill:"#FAFAFA",rx:"7.5"},void 0,0,{fileName:gt,lineNumber:20,columnNumber:7},this),Pe("rect",{width:"15",height:"15",x:".5",y:".5",stroke:"currentColor",rx:"7.5"},void 0,0,{fileName:gt,lineNumber:21,columnNumber:7},this)]},void 0,0,{fileName:gt,lineNumber:11,columnNumber:5},this)}var _t="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/RadioChecked.tsx";function bt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"none",viewBox:"0 0 16 16","data-component":"RadioCheckedIcon",...e,children:[Pe("rect",{width:"15",height:"15",x:".5",y:".5",fill:"#FAFAFA",rx:"7.5"},void 0,0,{fileName:_t,lineNumber:20,columnNumber:7},this),Pe("rect",{width:"15",height:"15",x:".5",y:".5",stroke:"currentColor",rx:"7.5"},void 0,0,{fileName:_t,lineNumber:21,columnNumber:7},this),Pe("rect",{width:"10",
height:"10",x:"3",y:"3",fill:"currentColor",rx:"5"},void 0,0,{fileName:_t,lineNumber:29,columnNumber:7},this)]},void 0,0,{fileName:_t,lineNumber:11,columnNumber:5},this)}var wt="/home/runner/work/frontend-shared/frontend-shared/src/components/icons/Show.tsx";function vt(e){return Pe("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",viewBox:"0 0 16 16","data-component":"ShowIcon",...e,children:Pe("path",{fill:"currentColor",d:"M8 2c4.36 0 8 2.6 8 6s-3.64 6-8 6-8-2.6-8-6 3.64-6 8-6m0 2C4.628 4 2 5.877 2 8s2.628 4 6 4 6-1.877 6-4-2.628-4-6-4m0 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4"},void 0,0,{fileName:wt,lineNumber:20,columnNumber:7},this)},void 0,0,{fileName:wt,lineNumber:11,columnNumber:5},this)}var yt="/home/runner/work/frontend-shared/frontend-shared/src/components/input/Button.tsx";function xt({children:e,classes:t,elementRef:n,expanded:o,pressed:i,title:r,icon:s,size:a="md",variant:l="secondary",unstyled:c=!1,role:d,...u}){const h=!c,f=h&&"custom"!==l,m=h&&"custom"!==a,g={
"aria-label":r};return"tab"===d?g["aria-selected"]=i:(g["aria-pressed"]=i,g["aria-expanded"]=o),Pe("button",{role:null!=d?d:"button","data-component":"Button",type:"button",...g,...u,className:Ae({"focus-visible-ring transition-colors whitespace-nowrap flex items-center":h},f&&{"font-semibold rounded":!0,"text-grey-7 bg-grey-1 enabled:hover:text-grey-9 enabled:hover:bg-grey-2 aria-pressed:text-grey-9 aria-expanded:text-grey-9":"secondary"===l,"text-grey-1 bg-grey-7 enabled:hover:bg-grey-8 disabled:text-grey-4":"primary"===l},m&&{"p-2 gap-x-2":"md"===a,"p-1 gap-x-1":"xs"===a,"p-1.5 gap-x-1.5":"sm"===a,"p-2.5 gap-x-1.5":"lg"===a},t),ref:n,title:r,children:[s&&Pe(s,{className:"w-em h-em"},void 0,0,{fileName:yt,lineNumber:120,columnNumber:16},this),e]},void 0,0,{fileName:yt,lineNumber:89,columnNumber:5},this)}const Nt=Ae("input-group:border input-group:rounded-none","input-group:first:rounded-l input-group:last:rounded-r","input-group:ml-[-1px] input-group:first:ml-0","focus:z-1")
;var Ct="/home/runner/work/frontend-shared/frontend-shared/src/components/input/IconButton.tsx";function St({children:e,classes:t,elementRef:n,pressed:o,expanded:i,icon:r,size:s="md",title:a,variant:l="secondary",unstyled:c=!1,...d}){const u=!c;return Pe(xt,{"data-component":"IconButton",...d,classes:Ae({"focus-visible-ring transition-colors rounded whitespace-nowrap":u,"flex items-center justify-center":u},u&&Nt,u&&"custom"!==l&&{"text-grey-7 bg-transparent enabled:hover:text-grey-9 aria-pressed:text-brand aria-expanded:text-brand":"secondary"===l,"text-brand bg-transparent enabled:hover:text-grey-9 disabled:text-grey-7":"primary"===l,"text-grey-7 bg-grey-2 enabled:hover:text-grey-9 enabled:hover:bg-grey-3 disabled:text-grey-5 aria-pressed:bg-grey-3 aria-expanded:bg-grey-3":"dark"===l},u&&"custom"!==s&&{"gap-x-2 touch:min-w-touch-minimum touch:min-h-touch-minimum":!0,"p-2":"md"===s,"p-1":"xs"===s,"p-1.5":"sm"===s,"p-2.5":"lg"===s},t),elementRef:n,title:a,pressed:o,expanded:i,unstyled:!0,children:[r&&Pe(r,{
className:"w-em h-em"},void 0,0,{fileName:Ct,lineNumber:84,columnNumber:16},this),e]},void 0,0,{fileName:Ct,lineNumber:49,columnNumber:5},this)}var Et="/home/runner/work/frontend-shared/frontend-shared/src/components/input/ToggleInput.tsx";function kt({children:e,elementRef:t,containerRef:n,checked:o,icon:i,checkedIcon:r,disabled:s,onChange:a,id:l,type:c,containerClasses:d,...u}){const h=o?r:i;return Pe("label",{className:Ae("relative flex items-center gap-x-1.5",{"cursor-pointer":!s,"opacity-70":s},d),htmlFor:l,"data-composite-component":"checkbox"===c?"Checkbox":"RadioButton",ref:n,children:[Pe("input",{...u,type:c,ref:t,className:Ae("peer","absolute w-em h-em","opacity-[.00001]",{"cursor-pointer":!s}),checked:o,disabled:s,id:l,onChange:a},void 0,0,{fileName:Et,lineNumber:66,columnNumber:7},this),Pe(h,{className:Ae("peer-focus-visible:ring","w-em h-em")},void 0,0,{fileName:Et,lineNumber:88,columnNumber:7},this),e]},void 0,0,{fileName:Et,lineNumber:51,columnNumber:5},this)}
var At="/home/runner/work/frontend-shared/frontend-shared/src/components/input/Checkbox.tsx";function Rt({checked:e,defaultChecked:t=!1,icon:n=et,checkedIcon:o=Ge,onChange:i,...r}){const s="boolean"==typeof e,[a,l]=ne(t);return Pe(kt,{icon:n,checkedIcon:o,type:"checkbox",checked:s?e:a,onChange:function(e){null==i||i.call(this,e),s||l(e.target.checked)},...r},void 0,0,{fileName:At,lineNumber:65,columnNumber:5},this)}const Pt=U(null);var Tt="/home/runner/work/frontend-shared/frontend-shared/src/components/input/RadioGroup.tsx";function Ot({value:e,children:t,subtitle:n,disabled:o}){const i=le(Pt);if(!i)throw new Error("RadioGroup.Radio can only be used as RadioGroup child");const{selected:r,disabled:s=o,onChange:a}=i,l=!s&&r===e;return Pe("div",{role:"radio","aria-checked":l,"aria-disabled":s,className:Ae("focus-visible-ring rounded-lg px-3 py-2 flex-1 group",{"bg-grey-3/50":l,"hover:bg-grey-3/25":!l&&!s,"opacity-70":s,"cursor-pointer":!s}),"data-value":e,onClick:s?void 0:()=>a(e),onKeyDown:s?void 0:t=>{
["Enter"," "].includes(t.key)&&(t.preventDefault(),a(e))},tabIndex:-1,children:[Pe("div",{className:"flex items-center gap-x-1.5",children:[l?Pe(bt,{},void 0,0,{fileName:Tt,lineNumber:68,columnNumber:23},this):Pe(pt,{},void 0,0,{fileName:Tt,lineNumber:68,columnNumber:46},this),t]},void 0,0,{fileName:Tt,lineNumber:67,columnNumber:7},this),n&&Pe("div",{className:Ae("pl-4 ml-1.5 mt-1 text-sm",{"text-grey-7":l,"text-grey-6 group-hover:text-grey-7":!l&&!s}),children:n},void 0,0,{fileName:Tt,lineNumber:72,columnNumber:9},this)]},void 0,0,{fileName:Tt,lineNumber:40,columnNumber:5},this)}Ot.displayName="RadioGroup.Radio",Object.assign((function({direction:e="horizontal",children:t,selected:n,onChange:o,disabled:i,"aria-label":r,"aria-labelledby":s,name:a}){const l=re(null);return ve(l,{loop:!1,selector:'[role="radio"]:not([aria-disabled="true"])',focusElement:e=>{o(e.dataset.value),e.focus()}}),Pe(Pt.Provider,{value:{selected:n,disabled:i,onChange:o},children:[Pe("div",{"aria-label":r,"aria-labelledby":s,ref:l,
role:"radiogroup",className:Ae("w-full flex gap-1.5",{"flex-col":"vertical"===e}),children:t},void 0,0,{fileName:Tt,lineNumber:134,columnNumber:7},this),a&&Pe("input",{type:"hidden","data-testid":"hidden-input",name:a,value:n,disabled:i},void 0,0,{fileName:Tt,lineNumber:146,columnNumber:9},this)]},void 0,0,{fileName:Tt,lineNumber:131,columnNumber:5},this)}),{Radio:Ot,displayName:"RadioGroup"});var Lt="/home/runner/work/frontend-shared/frontend-shared/src/components/feedback/Popover.tsx";const Mt=".15rem",It=8;function Bt(e,t,n,o,i){oe((()=>{if(!i)return()=>{};const t=e.current,o=e=>{"open"===e.oldState&&"closed"===e.newState&&n()};return t.addEventListener("toggle",o),()=>t.removeEventListener("toggle",o)}),[i,n,e]);const r=o&&!i;!function(e,t,{enabled:n=!0}={}){oe((()=>{if(!n)return()=>{};const o=document.body,i=new be,r=n=>{e.current&&!n.composedPath().includes(e.current)&&t(n)};return i.add(o,"mousedown",r),i.add(o,"click",r),()=>{i.removeAll()}}),[e,n,t])}(e,(e=>{e.composedPath().includes(t.current)||n()
}),{enabled:r}),function(e,t,{enabled:n=!0}={}){oe((()=>{if(!n)return()=>{};const o=document.body,i=new be;return i.add(o,"keydown",(n=>{e.includes(n.key)&&t(n)})),()=>{i.removeAll()}}),[n,t,e])}(["Escape"],n,{enabled:r})}function Ft({anchorElementRef:e,children:t,open:n,onClose:o,align:i="left",classes:r,variant:s="panel",restoreFocusOnClose:a=!0,asNativePopover:l=HTMLElement.prototype.hasOwnProperty("popover")}){const c=re(null);return function(e,t,n,o,i){const r=ae((()=>{const n=t.current,r=e.current,s=e=>{Object.assign(n.style,e);const t=Object.keys(e);return()=>t.map((e=>n.style[e]=""))},a=window.innerHeight,{top:l,bottom:c,left:d,height:u,width:h}=r.getBoundingClientRect(),f=a-c,{height:m,width:g}=n.getBoundingClientRect(),p=f<m&&l>f;if(!o)return s(p?{bottom:"100%",marginBottom:Mt}:{top:"100%",marginTop:Mt});const{top:_,width:b}=document.body.getBoundingClientRect(),w=Math.abs(_),v=(i?d+h:b-d)-It;let y=d;return g>v?y=i?It:y-(g-v):i&&g>h&&(y-=g-h),s({minWidth:`${h}px`,
top:p?`calc(${w+l-m}px - ${Mt})`:`calc(${w+l+u}px + ${Mt})`,left:`${Math.max(It,y)}px`})}),[o,e,t,i]);ie((()=>{if(!n)return()=>{};const e=t.current;o&&e.togglePopover(!0);const i=r();if(!o)return i;const s=new be;s.add(document.body,"scroll",r,{capture:!0});const a=new ResizeObserver(r);return a.observe(e),()=>{o&&(null==e||e.togglePopover(!1)),i(),s.removeAll(),a.disconnect()}}),[r,o,n,t])}(e,c,n,l,"right"===i),Bt(c,e,o,n,l),ie((()=>{const e=n?document.activeElement:null;return()=>{a&&e&&e.focus()}}),[n,a]),Pe("div",{className:Ae("absolute z-5","panel"===s&&["max-h-80 overflow-y-auto overflow-x-hidden","rounded border bg-white shadow hover:shadow-md focus-within:shadow-md"],l&&["max-w-[calc(100%-16px)]","p-0 m-0"],!l&&{hidden:!n,"right-0":"right"===i,"min-w-full":!0},r),ref:c,popover:l&&"auto","data-testid":"popover","data-component":"Popover",children:n&&t},void 0,0,{fileName:Lt,lineNumber:298,columnNumber:5},this)}const Dt=U(null)
;var Ht="/home/runner/work/frontend-shared/frontend-shared/src/components/input/Select.tsx";function Vt(e,t){return"function"==typeof e?e(t):e}function Ut({value:e,children:t,disabled:n=!1,classes:o,elementRef:i,title:r}){const s=re(null),a=re(null),l=Ne(i),c=e=>e.target===s.current||e.target===a.current,d=le(Dt);if(!d)throw new Error("Select.Option can only be used as Select or MultiSelect child");const{selectValue:u,value:h,multiple:f}=d,m=se((()=>!n&&(f?h.includes(e)||0===h.length&&void 0===e:h===e)),[h,n,f,e]),g=ae((()=>{const t={closeListbox:!0};u(f?void 0!==e?[e]:[]:e,t)}),[f,u,e]),p=ae((()=>{if(!f)return;const t={closeListbox:void 0===e};if(void 0===e)return void u([],t);const n=h.indexOf(e);if(-1===n)u([...h,e],t);else{const e=[...h];e.splice(n,1),u(e,t)}}),[h,f,u,e]);return Pe("li",{className:Ae("w-full ring-inset outline-none rounded-none select-none","px-1 mb-1 first:mt-1 whitespace-nowrap group",{"text-grey-4":n,"cursor-pointer":!n},o),onClick:e=>{n||c(e)||g()},onKeyDown:e=>{
n||(["Enter"," "].includes(e.key)&&!c(e)?(e.preventDefault(),g()):s.current&&"ArrowRight"===e.key&&(e.preventDefault(),s.current.focus()))},role:"option","aria-disabled":n,"aria-selected":m,tabIndex:m?0:-1,ref:l,title:r,children:Pe("div",{className:Ae("flex justify-between items-center","w-full rounded",{"hover:bg-grey-1 group-focus-visible:ring":!n,"bg-grey-1 hover:bg-grey-2":m}),children:[Pe("div",{className:Ae("py-2 pl-3",{truncate:"truncate"===d.listboxOverflow,"whitespace-normal":"wrap"===d.listboxOverflow}),children:Vt(t,{selected:m,disabled:n})},void 0,0,{fileName:Ht,lineNumber:203,columnNumber:9},this),!f&&Pe("div",{className:"px-3",children:Pe(Ke,{className:Ae("text-grey-6 scale-125",{"opacity-0":!m})},void 0,0,{fileName:Ht,lineNumber:213,columnNumber:13},this)},void 0,0,{fileName:Ht,lineNumber:212,columnNumber:11},this),f&&Pe(Rt,{containerClasses:Ae("self-stretch px-3","text-lg",{"text-grey-6":m,"text-grey-3 hover:text-grey-6":!m}),checked:m,checkedIcon:Je,elementRef:s,containerRef:a,onChange:p,
onKeyDown:e=>{var t;"ArrowLeft"===e.key&&(e.preventDefault(),null===(t=l.current)||void 0===t||t.focus())}},void 0,0,{fileName:Ht,lineNumber:224,columnNumber:11},this)]},void 0,0,{fileName:Ht,lineNumber:193,columnNumber:7},this)},void 0,0,{fileName:Ht,lineNumber:146,columnNumber:5},this)}function qt({buttonContent:e,value:t,onChange:n,children:o,disabled:i,elementRef:r,buttonId:s,buttonClasses:a,listboxClasses:l,popoverClasses:c=l,containerClasses:d,onListboxScroll:u,right:h=!1,alignListbox:f=(h?"right":"left"),multiple:m,listboxOverflow:g="truncate","aria-label":p,"aria-labelledby":_,listboxAsPopover:b}){const w=re(null),v=re(null),[y,x]=ne(!1),N=ae((()=>x(!1)),[x]),C=ce(),S=Ne(r),E=ce(),k=ae(((e,t)=>{n(e),t.closeListbox&&N()}),[n,N]);return function(e,t,{enabled:n=!0}={}){oe((()=>{if(!n||!e.current)return()=>{};const o=new be;return o.add(e.current,"focusout",(n=>{const o=n;e.current&&!e.current.contains(o.relatedTarget)&&t(o)})),()=>{o.removeAll()}}),[e,n,t])}(w,N),ve(v,{horizontal:!1,loop:!1,autofocus:!0,
containerVisible:y,selector:'[role="option"]:not([aria-disabled="true"])'}),Pe("div",{className:Ae("relative w-full border rounded",{"border-grey-5":y},Nt,d),ref:w,children:[Pe("button",{id:null!=s?s:E,className:Ae("focus-visible-ring transition-colors whitespace-nowrap","w-full flex items-center justify-between gap-x-2","bg-grey-0 disabled:bg-grey-1 disabled:text-grey-6","text-left","rounded-[inherit]",a),type:"button",role:"combobox",disabled:i,"aria-expanded":y,"aria-haspopup":"listbox","aria-controls":C,"aria-label":p,"aria-labelledby":_,ref:S,onClick:()=>x((e=>!e)),onKeyDown:e=>{"ArrowDown"!==e.key||y||(e.preventDefault(),x(!0))},"data-testid":"select-toggle-button",children:[Pe("div",{className:"pl-2 py-2 truncate grow",children:e},void 0,0,{fileName:Ht,lineNumber:436,columnNumber:9},this),Pe("div",{className:"pr-2 py-2 text-grey-6",children:y?Pe(st,{},void 0,0,{fileName:Ht,lineNumber:438,columnNumber:26},this):Pe(lt,{},void 0,0,{fileName:Ht,lineNumber:438,columnNumber:49},this)},void 0,0,{fileName:Ht,
lineNumber:437,columnNumber:9},this)]},void 0,0,{fileName:Ht,lineNumber:403,columnNumber:7},this),Pe(Dt.Provider,{value:{value:t,selectValue:k,multiple:m,listboxOverflow:g},children:Pe(Ft,{anchorElementRef:w,open:y,onClose:N,asNativePopover:b,align:f,classes:c,children:Pe("ul",{role:"listbox",id:C,ref:v,"aria-multiselectable":m,"aria-labelledby":null!=s?s:E,"aria-orientation":"vertical",onScroll:u,children:o},void 0,0,{fileName:Ht,lineNumber:459,columnNumber:11},this)},void 0,0,{fileName:Ht,lineNumber:451,columnNumber:9},this)},void 0,0,{fileName:Ht,lineNumber:442,columnNumber:7},this)]},void 0,0,{fileName:Ht,lineNumber:394,columnNumber:5},this)}Ut.displayName="Select.Option",Object.assign((function(e){return qt({...e,multiple:!1})}),{Option:Ut,displayName:"Select"}),Object.assign((function(e){return qt({...e,multiple:!0})}),{Option:Ut,displayName:"MultiSelect"}),U({}),U(null);var $t="/home/runner/work/frontend-shared/frontend-shared/src/components/feedback/Callout.tsx"
;function Wt({children:e,classes:t,elementRef:n,icon:o,status:i="notice",size:r="md",variant:s="outlined",unstyled:a=!1,...l}){const c=!a,d=c&&"custom"!==s,u=c&&"custom"!==r;let h=o;if(!h)switch(i){case"success":h=Ke;break;case"error":h=De;break;default:h=je}const f=d&&u;return Pe("div",{"data-component":"Callout",...l,ref:n,className:Ae(c&&"flex items-center border",d&&{"rounded border":!0,"shadow hover:shadow-md cursor-pointer":"raised"===s,"border-yellow-notice":"notice"===i,"border-green-success":"success"===i,"border-red-error":"error"===i},d&&{"bg-yellow-notice":"notice"===i&&f,"bg-green-success":"success"===i&&f,"bg-red-error":"error"===i&&f,"bg-white":!f},t),children:[f&&Pe("div",{className:Ae({"p-2":"md"===r,"p-1.5":"sm"===r,"p-3":"lg"===r}),children:Pe(h,{"data-testid":"callout-icon",className:Ae("text-white",{"w-[1.25em] h-[1.25em]":"md"===r,"w-[0.85em] h-[0.85em]":"sm"===r,"w-[1.5em] h-[1.5em]":"lg"===r})},void 0,0,{fileName:$t,lineNumber:95,columnNumber:11},this)},void 0,0,{fileName:$t,
lineNumber:88,columnNumber:9},this),Pe("div",{className:Ae(u&&{"p-2":"md"===r,"py-1.5 px-2":"sm"===r,"p-3":"lg"===r},c&&"grow",d&&"bg-white rounded-r"),children:e},void 0,0,{fileName:$t,lineNumber:105,columnNumber:7},this)]},void 0,0,{fileName:$t,lineNumber:64,columnNumber:5},this)}var zt="/home/runner/work/frontend-shared/frontend-shared/src/components/feedback/ToastMessages.tsx";function jt({message:e,onDismiss:t}){return Pe(Wt,{classes:Ae({"sr-only":e.visuallyHidden}),status:e.type,onClick:()=>t(e.id),variant:"raised",children:e.message},void 0,0,{fileName:zt,lineNumber:55,columnNumber:5},this)}const Xt=({direction:e,onTransitionEnd:t,children:n,transitionClasses:o={}})=>{const i="out"===e,r=re(null),s=se((()=>{const{transitionIn:e="animate-fade-in",transitionOut:t="animate-fade-out"}=o;return{[e]:!i,[t]:i}}),[i,o]);return Pe("div",{"data-testid":"animation-container",onAnimationEnd:n=>{n.target===r.current&&(null==t||t(null!=e?e:"in"))},ref:r,className:Ae("relative w-full container",s),children:n
},void 0,0,{fileName:zt,lineNumber:103,columnNumber:5},void 0)};function Kt({messages:e,onMessageDismiss:t,transitionClasses:n,setTimeout_:o=setTimeout}){const[i,r]=ne([]),s=re(new Map),a=ae((e=>r((t=>[...t,e]))),[]),l=ae((e=>{const t=o((()=>{a(e),s.current.delete(e)}),5e3);s.current.set(e,t)}),[a,o]),c=ae(((e,n)=>{var o;const i=null===(o=n.autoDismiss)||void 0===o||o;"in"===e&&i&&l(n.id),"out"===e&&(t(n.id),r((e=>e.filter((e=>e!==n.id)))))}),[l,t]);return ie((()=>{const e=s.current;return()=>{e.forEach((e=>clearTimeout(e)))}}),[]),Pe("ul",{"aria-live":"polite","aria-relevant":"additions",className:"w-full space-y-2","data-component":"ToastMessages",children:e.map((e=>{const t=i.includes(e.id);return Pe("li",{className:Ae({"mb-2":!e.visuallyHidden}),children:Pe(Xt,{direction:t?"out":"in",onTransitionEnd:t=>c(t,e),transitionClasses:n,children:Pe(jt,{message:e,onDismiss:a},void 0,0,{fileName:zt,lineNumber:206,columnNumber:15},this)},void 0,0,{fileName:zt,lineNumber:201,columnNumber:13},this)},e.id,0,{
fileName:zt,lineNumber:189,columnNumber:11},this)}))},void 0,0,{fileName:zt,lineNumber:180,columnNumber:5},this)}var Qt="/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/Link.tsx";function Gt({children:e,classes:t,elementRef:n,underline:o="none",unstyled:i=!1,variant:r="brand",...s}){const a=!i;return Pe("a",{"data-component":"Link",rel:"noopener noreferrer",...s,className:Ae(a&&{"focus-visible-ring rounded":!0,"no-underline hover:no-underline":"none"===o,"underline hover:underline":"always"===o,"no-underline hover:underline":"hover"===o},a&&"custom"!==r&&{"text-brand hover:text-brand-dark":"brand"===r,"text-color-text-light hover:text-brand":"text-light"===r,"text-color-text hover:text-brand-dark":"text"===r},t),ref:n,children:e},void 0,0,{fileName:Qt,lineNumber:37,columnNumber:5},this)}var Yt="/home/runner/work/frontend-shared/frontend-shared/src/components/navigation/PointerButton.tsx";function Jt({children:e,classes:t,elementRef:n,expanded:o,pressed:i,title:r,direction:s,...a}){
return Pe(xt,{"data-component":"PointerButton",...a,elementRef:n,classes:Ae("relative w-[26px] h-[16px]","flex items-center justify-center","bg-white rounded-[4px] border","before:absolute before:border-transparent","after:absolute after:border-transparent","text-[10px] text-color-text-light leading-none font-semibold",{"shadow-[1px_1px_1px_rgba(0,0,0,0.1)]":"down"!==s,"shadow-[1px_0px_1px_rgba(0,0,0,0.1)]":"down"===s},{"rounded-r-[4px] rounded-l-[2px]":"left"===s,"before:right-full before:top-1/2 after:right-full after:top-1/2":"left"===s,"before:mt-[-8px] before:border-8 before:border-r-[5px] before:border-r-grey-3":"left"===s,"after:mt-[-7px] after:border-[7px] after:border-r-[4px] after:border-r-white":"left"===s},{"z-1 rounded-t-px-sm rounded-b-px":"up"===s,"before:top-auto before:left-1/2 before:bottom-full after:top-auto after:left-1/2 after:bottom-full":"up"===s,"before:ml-[-13px] before:border-[13px] before:border-b-[6px] before:border-b-grey-3":"up"===s,
"after:ml-[-12px] after:border-[12px] after:border-b-[5px] after:border-b-white":"up"===s},{"z-1 rounded-t-px rounded-b-px-sm":"down"===s,"before:top-full before:left-1/2 after:top-full after:left-1/2":"down"===s,"before:ml-[-13px] before:border-[13px] before:border-t-[6px] before:border-t-grey-3":"down"===s,"after:ml-[-12px] after:border-[12px] after:border-t-[5px] after:border-t-white":"down"===s},t),expanded:o,pressed:i,title:r,variant:"custom",size:"custom",children:e},void 0,0,{fileName:Yt,lineNumber:48,columnNumber:5},this)}function Zt(e){const t=e.toString(16);return 1===t.length?"0"+t:t}function en(e){const t=new Uint8Array(e/2);return window.crypto.getRandomValues(t),Array.from(t).map(Zt).join("")}function tn(e){if(null===e||"object"!=typeof e)return!1;for(const t of["frame1","frame2","type","requestId"])if("string"!=typeof e[t])return!1;return!0}class nn extends Error{constructor(e){super(e)}}class on{constructor({hostFrame:e,source:t,sourceId:n}){this._hostFrame=e,this._source=t,this._sourceId=n,
this._listeners=new be}destroy(){this._listeners.removeAll()}async discover(e){const t=en(6);return new Promise(((n,o)=>{const i=()=>{this._hostFrame.postMessage({frame1:this._source,frame2:e,type:"request",requestId:t,sourceId:this._sourceId},"*")},r=setInterval(i,250),s=setTimeout((()=>{clearInterval(r),o(new nn(`Unable to establish ${this._source}-${e} communication channel`))}),2e4),a=this._listeners.add(window,"message",(i=>{const{data:l,ports:c}=i;tn(l)&&l.requestId===t&&"request"!==l.type&&(clearInterval(r),clearTimeout(s),this._listeners.remove(a),"string"==typeof l.error?o(new nn(l.error)):c.length>0?n(c[0]):o(new nn(`${this._source}-${e} port request failed`)))}));i()}))}}var rn,sn={exports:{}};var an=function(){if(rn)return sn.exports;function e(){}return rn=1,e.prototype={on:function(e,t,n){var o=this.e||(this.e={});return(o[e]||(o[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var o=this;function i(){o.off(e,i),t.apply(n,arguments)}return i._=t,this.on(e,i,n)},emit:function(e){
for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),o=0,i=n.length;o<i;o++)n[o].fn.apply(n[o].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),o=n[e],i=[];if(o&&t)for(var r=0,s=o.length;r<s;r++)o[r].fn!==t&&o[r].fn._!==t&&i.push(o[r]);return i.length?n[e]=i:delete n[e],this}},sn.exports=e,sn.exports.TinyEmitter=e,sn.exports}();let ln=null;function cn(e){return e instanceof Error?{message:e.message,stack:e.stack}:{message:String(e),stack:void 0}}function dn(e,t){if(!ln)return;const n={type:"hypothesis-error",error:e instanceof Error?e:cn(e),context:t};try{try{ln.postMessage(n,"*")}catch(e){if(!(e instanceof DOMException&&"DataCloneError"===e.name))throw e;n.error=cn(n.error),ln.postMessage(n,"*")}}catch(e){console.warn("Unable to report Hypothesis error",e)}}function un(e){ln=e}class hn{constructor(e){this._hypothesisAppsOrigin=e,this._emitter=new an.TinyEmitter,this._handledRequests=new Set,this._sidebarHostChannel=new MessageChannel,this._sidebarConnected=!1,
this._listeners=new be,this._allowedMessages=[{allowedOrigin:"*",frame1:"guest",frame2:"host",type:"request"},{allowedOrigin:"*",frame1:"guest",frame2:"sidebar",type:"request"},{allowedOrigin:this._hypothesisAppsOrigin,frame1:"sidebar",frame2:"host",type:"request"},{allowedOrigin:this._hypothesisAppsOrigin,frame1:"notebook",frame2:"sidebar",type:"request"}],this._listen()}_listen(){const e="Handling port request",t=new Set,n=n=>{t.has(n)||(t.add(n),dn(new Error(n),e))};var o,i;this._listeners.add(window,"message",(o=e=>{const{data:t,origin:o,source:i}=e;if(!i)return;if(!tn(t)||"request"!==t.type)return;const{frame1:r,frame2:s,requestId:a,sourceId:l}=t,c=`${r}-${s}`;if(!function(e){return!(null===e||e instanceof MessagePort||window.ServiceWorker&&e instanceof ServiceWorker)}(i))return void n(`Ignored port request for channel ${c} from non-Window source`);if(void 0===this._allowedMessages.find((({allowedOrigin:e,...n})=>this._messageMatches({allowedMessage:n,allowedOrigin:e,data:t,origin:o
}))))return void n(`Ignored invalid port request for channel ${c} from ${o}`);if(this._handledRequests.has(a))return;this._handledRequests.add(a);const d="null"===o?"*":o,u="sidebar-host"===c?this._sidebarHostChannel:new MessageChannel,h={frame1:r,frame2:s,type:"offer",requestId:a,sourceId:l};if(u===this._sidebarHostChannel){if(this._sidebarConnected)return console.warn("Ignoring second request from Hypothesis sidebar to connect to host frame"),h.error="Received duplicate port request",void i.postMessage(h,d);this._sidebarConnected=!0}i.postMessage(h,d,[u.port1]),"sidebar"===s?this._sidebarHostChannel.port2.postMessage(h,[u.port2]):"host"===s&&this._emitter.emit("frameConnected",r,u.port2)},i=e,(...e)=>{try{return o(...e)}catch(e){throw dn(e,i),e}}))}_messageMatches({allowedMessage:e,allowedOrigin:t,data:n,origin:o}){return("*"===t||o===t)&&function(e,t){return!!tn(e)&&JSON.stringify(e,Object.keys(t).sort())===JSON.stringify(t,Object.keys(t).sort())}(n,e)}on(e,t){this._emitter.on(e,t)}destroy(){
this._listeners.removeAll()}}const fn="1.0.0",mn="frame-rpc";function gn(e,t=[],n=-1){return{protocol:mn,version:fn,arguments:t,method:e,sequence:n}}function pn(e,t,n=[],o=-1){e.postMessage(gn(t,n,o))}function _n(e){const t=e.match(/\bAppleWebKit\/([0-9]+)\b/);if(!t)return!1;if(parseInt(t[1])<=537)return!1;const n=e.match(/\bVersion\/([0-9]+)\b/);if(!n)return!1;return!(parseInt(n[1])>=16)}class bn{constructor({userAgent:e=navigator.userAgent,currentWindow:t=window,forceUnloadListener:n=!1}={}){this._port=null,this._methods=new Map,this._sequence=1,this._callbacks=new Map,this._listeners=new be,"onclose"in MessagePort.prototype&&!n||this._listeners.add(t,"unload",(n=>{n instanceof CustomEvent||this._port&&(pn(this._port,"close"),t!==t.parent&&_n(e)&&t.parent.postMessage({type:"hypothesisPortClosed"},"*",[this._port]))})),this._pendingCalls=[],this._destroyed=!1,this._receivedCloseEvent=!1}on(e,t){if(this._port)throw new Error("Cannot add a method handler after a port is connected");this._methods.set(e,t)}
connect(e){this._port=e,this._listeners.add(e,"message",(e=>this._handle(e))),this._listeners.add(e,"close",(()=>{e.dispatchEvent(new MessageEvent("message",{data:gn("close")}))})),e.start(),pn(e,"connect");for(const[e,t]of this._pendingCalls)this.call(e,...t);this._pendingCalls=[]}destroy(){this._port&&(pn(this._port,"close"),this._port.close()),this._destroyed=!0,this._listeners.removeAll()}call(e,...t){if(this._port||this._pendingCalls.push([e,t]),!this._port||this._destroyed)return;const n=this._sequence++,o=t[t.length-1];"function"==typeof o&&(this._callbacks.set(n,o),t=t.slice(0,-1)),pn(this._port,e,t,n)}_parseMessage({data:e}){return e&&"object"==typeof e?e.protocol!==mn||e.version!==fn?null:Array.isArray(e.arguments)?e:null:null}_handle(e){const t=this._parseMessage(e),n=this._port;if(t&&n)if("method"in t){if("close"===t.method){if(this._receivedCloseEvent)return;this._receivedCloseEvent=!0}const e=this._methods.get(t.method);if(!e)return;const o=(...e)=>{const o={arguments:e,protocol:mn,
response:t.sequence,version:fn};n.postMessage(o)};e(...t.arguments,o)}else if("response"in t){const e=this._callbacks.get(t.response);this._callbacks.delete(t.response),e&&e(...t.arguments)}}}function wn(e){if("string"==typeof e&&"false"===e.trim().toLocaleLowerCase())return!1;const t=Number(e);return isNaN(t)?"string"==typeof e:Boolean(t)}function vn(e){for(var t={},n=e.querySelectorAll("script.js-hypothesis-config"),o=0;o<n.length;o++){var i=void 0;try{i=JSON.parse(n[o].textContent||"")}catch(e){console.warn("Could not parse settings from js-hypothesis-config tags",e),i={}}Object.assign(t,i)}return t}function yn(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function xn(e){return e.width<=0||e.height<=0}function Nn(e,t,n,o){return Math.max(e,n)<Math.min(t,o)}function Cn(e,t){return!xn(e)&&!xn(t)&&(Nn(e.left,e.right,t.left,t.right)&&Nn(e.top,e.bottom,t.top,t.bottom))}function Sn(e,t){return Nn(e.top,e.bottom,t.top,t.bottom)}function En(e,t){return Nn(e.left,e.right,t.left,t.right)}function kn(e,t){
if(xn(e))return t;if(xn(t))return e;const n=Math.min(e.left,t.left),o=Math.min(e.top,t.top),i=Math.max(e.right,t.right),r=Math.max(e.bottom,t.bottom);return new DOMRect(n,o,i-n,r-o)}function An(e){return new DOMPoint((e.left+e.right)/2,(e.top+e.bottom)/2)}function Rn(e){return e.nodeType===Node.ELEMENT_NODE}function Pn(e){return e.nodeType===Node.TEXT_NODE}const Tn=["p",".para"];let On;function Ln(e,t=0,n=e.data.length){return On||(On=document.createRange()),On.setStart(e,t),On.setEnd(e,n),On.getBoundingClientRect()}function Mn(e){const t=e.getBoundingClientRect();return t.x-=e.scrollLeft,t.y-=e.scrollTop,t.height=Math.max(t.height,e.scrollHeight),t.width=Math.max(t.width,e.scrollWidth),t}function*In(e,t,n){let o=e.firstChild;for(;o;){if(Rn(o)){const e=Cn(Mn(o),t);n(o)&&e&&(yield*In(o,t,n))}else Pn(o)&&Cn(Ln(o),t)&&(yield o);o=o.nextSibling}}function Bn(e,t){let n=null;const o=e=>!function(e){switch(getComputedStyle(e).position){case"fixed":case"sticky":return!0;default:return!1}}(e)
;e:for(const s of In(e,t,o)){let e=0;for(const o of s.data.split(/\b/)){if(/\S/.test(o)){const a=e,l=e+o.length,c=Ln(s,a,l);if(r=c,!xn(i=t)&&!xn(r)&&r.left>=i.left&&r.right<=i.right&&r.top>=i.top&&r.bottom<=i.bottom){n=document.createRange(),n.setStart(s,a),n.setEnd(s,l);break e}}e+=o.length}}var i,r;return n}function Fn(e,t=document.documentElement,n=new DOMRect(0,0,window.innerWidth,window.innerHeight)){const o=Bn(t,n);if(!o)return e(),0;const i=o.getBoundingClientRect().top;e();const r=o.getBoundingClientRect().top-i;return t.scrollTop+=r,r}function Dn(e,t,n){const o=e.document.querySelector(`link[type="application/annotator+${n}"][rel="${t}"]`);if(!o)throw new Error(`No application/annotator+${n} (rel="${t}") link in the document`);if(!o.href)throw new Error(`application/annotator+${n} (rel="${t}") link has no href`);return o.href}function Hn(e){return"string"==typeof e?e:null}function Vn(e){const t=function(e){if(!yn(e,"hypothesisConfig"))return{};if("function"!=typeof e.hypothesisConfig){
const e="https://h.readthedocs.io/projects/client/en/latest/publishers/config/#window.hypothesisConfig";return console.warn("hypothesisConfig must be a function, see: "+e),{}}return e.hypothesisConfig()}(e),n=wn(t.ignoreOtherConfiguration)?{}:vn(e.document);function o(e){return yn(t,e)?t[e]:yn(n,e)?n[e]:void 0}return{get annotations(){return Hn(n.annotations)||function(){const t=e.location.href.match(/#annotations:([A-Za-z0-9_-]+)$/);return t?t[1]:null}()},get clientUrl(){return Dn(e,"hypothesis-client","javascript")},get group(){return Hn(n.group)||function(){const t=e.location.href.match(/#annotations:group:([A-Za-z0-9_-]+)$/);return t?t[1]:null}()},get notebookAppUrl(){return Dn(e,"notebook","html")},get profileAppUrl(){return Dn(e,"profile","html")},get showHighlights(){return function(){const e=o("showHighlights");switch(e){case"always":case"never":case"whenSidebarOpen":return e;case!0:return"always";case!1:return"never";default:return"always"}}()},get sidebarAppUrl(){return Dn(e,"sidebar","html")},
get query(){return Hn(n.query)||function(){const t=e.location.href.match(/#annotations:(query|q):(.+)$/i);if(t)try{return decodeURIComponent(t[2])}catch{}return null}()},get sideBySide(){return function(){const e=o("sideBySide");if(!function(e){return null!==e&&"object"==typeof e}(e))return{mode:"auto"};const t="mode"in e&&function(e){return"string"==typeof e&&["auto","manual"].includes(e)}(e.mode)?e.mode:"auto";return"auto"===t?{mode:t}:{mode:t,isActive:"isActive"in e&&"function"==typeof e.isActive?e.isActive:void 0}}()},hostPageSetting:o}}const Un=(e,t)=>e.hostPageSetting(t),qn={annotations:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.annotations},appType:{allowInBrowserExt:!0,defaultValue:null,getValue:Un},branding:{defaultValue:null,allowInBrowserExt:!1,getValue:Un},bucketContainerSelector:{defaultValue:null,allowInBrowserExt:!1,getValue:Un},clientUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.clientUrl},contentInfoBanner:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},
contentReady:{allowInBrowserExt:!0,defaultValue:null,getValue:Un},enableExperimentalNewNoteButton:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},group:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.group},focus:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},theme:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},usernameUrl:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},onLayoutChange:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},openSidebar:{allowInBrowserExt:!0,defaultValue:!1,coerce:wn,getValue:Un},query:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.query},requestConfigFromFrame:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},services:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},showHighlights:{allowInBrowserExt:!1,defaultValue:"always",getValue:e=>e.showHighlights},notebookAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.notebookAppUrl},profileAppUrl:{allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.profileAppUrl},sidebarAppUrl:{
allowInBrowserExt:!0,defaultValue:null,getValue:e=>e.sidebarAppUrl},subFrameIdentifier:{allowInBrowserExt:!0,defaultValue:null,getValue:Un},externalContainerSelector:{allowInBrowserExt:!1,defaultValue:null,getValue:Un},sideBySide:{allowInBrowserExt:!0,getValue:e=>e.sideBySide}};function $n(e,t=window){const n=Vn(t),o={};for(const r of function(e){const t={annotator:["clientUrl","contentInfoBanner","contentReady","subFrameIdentifier","sideBySide"],sidebar:["appType","annotations","branding","bucketContainerSelector","enableExperimentalNewNoteButton","externalContainerSelector","focus","group","onLayoutChange","openSidebar","query","requestConfigFromFrame","services","showHighlights","sidebarAppUrl","theme","usernameUrl"],notebook:["branding","group","notebookAppUrl","requestConfigFromFrame","services","theme","usernameUrl"],profile:["profileAppUrl"]};return"all"===e?Object.values(t).flat():t[e]}(e)){
const e=qn[r],s=void 0!==e.defaultValue,a=!((i=Dn(t,"sidebar","html")).startsWith("http://")||i.startsWith("https://"));if(!e.allowInBrowserExt&&a){s&&(o[r]=e.defaultValue);continue}const l=e.getValue(n,r);void 0!==l?o[r]=e.coerce?e.coerce(l):l:s&&(o[r]=e.defaultValue)}var i;return o}const Wn={alt:1,ctrl:2,meta:4,shift:8};function zn(e,t){if(!(e instanceof KeyboardEvent))return!1;const n=t.split("+").map((e=>e.toLowerCase()));let o=0,i=null;for(const e of n){const t=Wn[e];if(t)o|=t;else{if(null!==i)throw new Error("Multiple non-modifier keys specified");i=e}}if(!i)throw new Error(`Invalid shortcut: ${t}`);return((e.ctrlKey?Wn.ctrl:0)|(e.metaKey?Wn.meta:0)|(e.altKey?Wn.alt:0)|(e.shiftKey?Wn.shift:0))===o&&e.key.toLowerCase()===i}function jn(e,t,{rootElement:n}={}){oe((()=>{if(e)return function(e,t,{rootElement:n=document.documentElement??void 0}={}){const o=n=>{zn(n,e)&&t(n)};return n?(n.addEventListener("keydown",o),()=>n.removeEventListener("keydown",o)):()=>{}}(e,t,{rootElement:n})}),[e,t,n])}
const Xn=(e=window)=>e.matchMedia("(pointer: coarse)").matches;function Kn({badgeCount:e}){return Pe("span",{className:Ae("rounded px-1 py-0.5","bg-current"),children:Pe("span",{className:"font-bold text-color-text-inverted",children:e})})}function Qn({arrowDirection:e}){return Pe("div",{className:Ae("absolute left-1/2 -translate-x-1/2 z-2","fill-white text-grey-3",{"top-0 -translate-y-full":"up"===e}),children:Pe("up"===e?mt:ht,{})})}function Gn({badgeCount:e,icon:t,label:n,onClick:o,shortcut:i}){jn(i,o);const r=i?`${n} (${i})`:n;return Pe(xt,{classes:Ae("text-grey-7","group-hover:text-grey-5","hover:group-hover:text-grey-9"),onClick:o,title:r,size:"custom",variant:"custom",children:Pe("div",{className:Ae("flex flex-col items-center gap-y-1 py-2.5 px-2","text-annotator-sm leading-none"),children:[t&&Pe(t,{className:"text-annotator-lg",title:r}),"number"==typeof e&&Pe(Kn,{badgeCount:e}),Pe("span",{"data-testid":"adder-button-label",children:n})]})})}function Yn({annotationCount:e,isVisible:t}){
return Pe("div",{className:"sr-only",children:[Pe("span",{"aria-live":"polite","aria-atomic":"true",role:"status","data-testid":"annotation-count-announce",children:e>0&&Pe("span",{children:[e," ",1===e?"annotation":"annotations"," for this selection."]})}),Pe("ul",{"aria-live":"polite","data-testid":"annotate-shortcuts-announce",children:t&&Pe(x,{children:[e>0&&Pe("li",{children:["Press ","'S'"," to show annotations."]}),Pe("li",{children:["Press ","'A'"," to annotate."]}),Pe("li",{children:["Press ","'H'"," to highlight."]})]})})]})}function Jn({arrowDirection:e,isVisible:t,onCommand:n,annotationCount:o=0}){const i=t?"a":null,r=t?"h":null,s=t?"s":null;return jn(t?"Escape":null,(()=>n("hide"))),Pe("div",{className:Ae("all-initial","border border-solid border-grey-3","absolute select-none bg-white rounded shadow-intense","opacity-5",{"animate-adder-pop-up":"up"===e&&t,"animate-adder-pop-down":"down"===e&&t}),"data-component":"AdderToolbar",dir:"ltr",style:{visibility:t?"visible":"hidden"},children:[Pe("div",{
className:Ae("flex group"),children:[Pe(Gn,{icon:Be,onClick:()=>n("annotate"),label:"Annotate",shortcut:i}),Pe(Gn,{icon:it,onClick:()=>n("highlight"),label:"Highlight",shortcut:r}),o>0&&Pe(x,{children:[Pe("div",{className:Ae("m-1.5 border-r border-grey-4 border-solid")}),Pe(Gn,{badgeCount:o,onClick:()=>n("show"),label:"Show",shortcut:s})]})]}),Pe(Qn,{arrowDirection:e}),Pe(Yn,{annotationCount:o,isVisible:t})]})}function Zn(e){const t=e.attachShadow({mode:"open"});!function(e){const t=document.querySelector('link[rel="preload"][href*="/build/styles/annotator.css"]')?.href;if(!t)return;const n=document.createElement("link");n.rel="stylesheet",n.href=t,e.appendChild(n)}(t);const n=window.applyFocusVisiblePolyfill;return n&&n(t),t}class eo{constructor(e,t){const n=`hypothesis-${e}`;this._element=document.createElement(n),this._shadowRoot=Zn(this._element),this._render=t}destroy(){V(null,this._shadowRoot),this._element.remove()}get element(){return this._element}render(){V(this._render(),this._shadowRoot)}}
let to=function(e){return e[e.DOWN=1]="DOWN",e[e.UP=2]="UP",e}({});function no(e){return e.toString()+"px"}class oo{constructor(e,t){this._view=e.ownerDocument.defaultView,this._isVisible=!1,this._arrowDirection="up",this._annotationsForSelection=[],this._onAnnotate=t.onAnnotate,this._onHighlight=t.onHighlight,this._onShowAnnotations=t.onShowAnnotations,this._container=new eo("adder",(()=>this._render())),e.appendChild(this._container.element),Object.assign(this._container.element.style,{position:"absolute",top:0,left:0}),this._container.render()}get annotationsForSelection(){return this._annotationsForSelection}set annotationsForSelection(e){this._annotationsForSelection=e,this._container.render()}hide(){this._isVisible=!1,this._container.render(),Object.assign(this._container.element.style,{top:0,left:0})}destroy(){this._container.destroy()}show(e,t){const{left:n,top:o,arrowDirection:i}=this._calculateTarget(e,t);this._showAt(n,o),this._isVisible=!0,this._arrowDirection=i===to.UP?"up":"down",
this._container.render()}_firstChild(){return this._container.element.shadowRoot.firstChild}_width(){return this._firstChild().getBoundingClientRect().width}_height(){return this._firstChild().getBoundingClientRect().height}_calculateTarget(e,t){let n,o,i;n=t&&!Xn()?to.DOWN:to.UP;const r=Math.min(20,e.width),s=this._width(),a=Xn()?10:0,l=this._height();return i=t?e.left-s/2+r:e.left+e.width-s/2-r,e.top-l<0&&n===to.DOWN?n=to.UP:e.top+l>this._view.innerHeight&&(n=to.DOWN),o=n===to.UP?e.top+e.height+10+a:e.top-l-10,i=Math.max(i,0),i=Math.min(i,this._view.innerWidth-s),o=Math.max(o,0),o=Math.min(o,this._view.innerHeight-l),{top:o,left:i,arrowDirection:n}}_findZindex(e,t){if(void 0===document.elementsFromPoint)return 32768
;const n=this._width(),o=this._height(),i=[...new Set([...document.elementsFromPoint(e,t),...document.elementsFromPoint(e,t+o),...document.elementsFromPoint(e+n/2,t+o/2),...document.elementsFromPoint(e+n,t),...document.elementsFromPoint(e+n,t+o)])].map((e=>+getComputedStyle(e).zIndex)).filter(Number.isInteger);return i.push(0),Math.max(...i)+1}_showAt(e,t){const n=function(e){let t=e.parentElement;for(;t.parentElement&&"static"===getComputedStyle(t).position;)t=t.parentElement;return t}(this._container.element).getBoundingClientRect(),o=this._findZindex(e,t);Object.assign(this._container.element.style,{left:no(e-n.left),top:no(t-n.top),zIndex:o})}_render(){return Pe(Jn,{isVisible:this._isVisible,arrowDirection:this._arrowDirection,onCommand:e=>{switch(e){case"annotate":this._onAnnotate(),this.hide();break;case"highlight":this._onHighlight(),this.hide();break;case"show":this._onShowAnnotations(this.annotationsForSelection);break;case"hide":this.hide()}},annotationCount:this.annotationsForSelection.length})}}
var io=function(e){return e[e.Forwards=1]="Forwards",e[e.Backwards=2]="Backwards",e}(io||{});function ro(e,t,n){const o=n===io.Forwards?t:t-1;if(""!==e.charAt(o).trim())return t;let i,r;if(n===io.Backwards?(i=e.substring(0,t),r=i.trimEnd()):(i=e.substring(t),r=i.trimStart()),!r.length)return-1;const s=i.length-r.length;return n===io.Backwards?t-s:t+s}function so(e,t){const n=e.commonAncestorContainer.ownerDocument.createNodeIterator(e.commonAncestorContainer,NodeFilter.SHOW_TEXT),o=t===io.Forwards?e.startContainer:e.endContainer,i=t===io.Forwards?e.endContainer:e.startContainer;let r=n.nextNode();for(;r&&r!==o;)r=n.nextNode();t===io.Backwards&&(r=n.previousNode());let s=-1;const a=()=>{if(r=t===io.Forwards?n.nextNode():n.previousNode(),r){const e=r.textContent,n=t===io.Forwards?0:e.length;s=ro(e,n,t)}};for(;r&&-1===s&&r!==i;)a();if(r&&s>=0)return{node:r,offset:s};throw new RangeError("No text nodes with non-whitespace text found in range")}function ao(e){switch(e.nodeType){case Node.ELEMENT_NODE:
case Node.TEXT_NODE:return e.textContent?.length??0;default:return 0}}function lo(e){let t=e.previousSibling,n=0;for(;t;)n+=ao(t),t=t.previousSibling;return n}function co(e,...t){let n=t.shift();const o=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),i=[];let r,s=o.nextNode(),a=0;for(;void 0!==n&&s;)r=s,a+r.data.length>n?(i.push({node:r,offset:n-a}),n=t.shift()):(s=o.nextNode(),a+=r.data.length);for(;void 0!==n&&r&&a===n;)i.push({node:r,offset:r.data.length}),n=t.shift();if(void 0!==n)throw new RangeError("Offset exceeds text length");return i}let uo=function(e){return e[e.FORWARDS=1]="FORWARDS",e[e.BACKWARDS=2]="BACKWARDS",e}({});class ho{constructor(e,t){if(t<0)throw new Error("Offset is invalid");this.element=e,this.offset=t}relativeTo(e){if(!e.contains(this.element))throw new Error("Parent is not an ancestor of current element");let t=this.element,n=this.offset;for(;t!==e;)n+=lo(t),t=t.parentElement;return new ho(t,n)}resolve(e={}){try{return co(this.element,this.offset)[0]}catch(t){
if(0===this.offset&&void 0!==e.direction){const n=document.createTreeWalker(this.element.getRootNode(),NodeFilter.SHOW_TEXT);n.currentNode=this.element;const o=e.direction===uo.FORWARDS,i=o?n.nextNode():n.previousNode();if(!i)throw t;return{node:i,offset:o?0:i.data.length}}throw t}}static fromCharOffset(e,t){switch(e.nodeType){case Node.TEXT_NODE:return ho.fromPoint(e,t);case Node.ELEMENT_NODE:return new ho(e,t);default:throw new Error("Node is not an element or text node")}}static fromPoint(e,t){switch(e.nodeType){case Node.TEXT_NODE:{if(t<0||t>e.data.length)throw new Error("Text node offset is out of range");if(!e.parentElement)throw new Error("Text node has no parent");const n=lo(e)+t;return new ho(e.parentElement,n)}case Node.ELEMENT_NODE:{if(t<0||t>e.childNodes.length)throw new Error("Child node offset is out of range");let n=0;for(let o=0;o<t;o++)n+=ao(e.childNodes[o]);return new ho(e,n)}default:throw new Error("Point is not in an element or text node")}}}class fo{constructor(e,t){this.start=e,
this.end=t}relativeTo(e){return new fo(this.start.relativeTo(e),this.end.relativeTo(e))}toRange(){let e,t;this.start.element===this.end.element&&this.start.offset<=this.end.offset?[e,t]=co(this.start.element,this.start.offset,this.end.offset):(e=this.start.resolve({direction:uo.FORWARDS}),t=this.end.resolve({direction:uo.BACKWARDS}));const n=new Range;return n.setStart(e.node,e.offset),n.setEnd(t.node,t.offset),n}static fromRange(e){const t=ho.fromPoint(e.startContainer,e.startOffset),n=ho.fromPoint(e.endContainer,e.endOffset);return new fo(t,n)}static fromOffsets(e,t,n){return new fo(new ho(e,t),new ho(e,n))}static trimmedRange(e){return function(e){if(!e.toString().trim().length)throw new RangeError("Range contains no non-whitespace text");if(e.startContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range startContainer is not a text node");if(e.endContainer.nodeType!==Node.TEXT_NODE)throw new RangeError("Range endContainer is not a text node");const t=e.cloneRange();let n=!1,o=!1;const i={
start:ro(e.startContainer.textContent,e.startOffset,io.Forwards),end:ro(e.endContainer.textContent,e.endOffset,io.Backwards)};if(i.start>=0&&(t.setStart(e.startContainer,i.start),n=!0),i.end>0&&(t.setEnd(e.endContainer,i.end),o=!0),n&&o)return t;if(!n){const{node:e,offset:n}=so(t,io.Forwards);e&&n>=0&&t.setStart(e,n)}if(!o){const{node:e,offset:n}=so(t,io.Backwards);e&&n>0&&t.setEnd(e,n)}return t}(fo.fromRange(e).toRange())}}const mo=".annotator-placeholder";function go(e){return!!e.parentElement&&null!==e.parentElement.closest(mo)}function po(e,t){const n=new Range;return e.compareBoundaryPoints(Range.START_TO_START,t)<=0?n.setStart(e.startContainer,e.startOffset):n.setStart(t.startContainer,t.startOffset),e.compareBoundaryPoints(Range.END_TO_END,t)>=0?n.setEnd(e.endContainer,e.endOffset):n.setEnd(t.endContainer,t.endOffset),n}function _o(e=document.getSelection()){if(!e||0===e.rangeCount)return null;let t=e.getRangeAt(0);for(let n=1;n<e.rangeCount;n++)t=po(t,e.getRangeAt(n));return t.collapsed?null:t}
function bo(e){if(e.focusNode===e.anchorNode)return e.focusOffset<e.anchorOffset;return _o(e).startContainer===e.focusNode}function wo(e,t){try{const n=t.nodeValue?.length??t.childNodes.length;return e.comparePoint(t,0)<=0&&e.comparePoint(t,n)>=0}catch{return!1}}function vo(e,t){const n=e.commonAncestorContainer,o=n.ownerDocument.createNodeIterator(n,NodeFilter.SHOW_ALL);let i;for(;i=o.nextNode();)wo(e,i)&&t(i)}function yo(e){const t=_o(e);if(!t)return null;const n=function(e){const t=[];return vo(e,(e=>{Pn(e)&&!e.textContent.match(/^\s*$/)&&t.push(e)})),t.flatMap((t=>{const n=t.ownerDocument.createRange();if(n.selectNodeContents(t),t===e.startContainer&&n.setStart(t,e.startOffset),t===e.endContainer&&n.setEnd(t,e.endOffset),n.collapsed)return[];const o=Array.from(n.getClientRects());return n.detach(),o}))}(t);return 0===n.length?null:bo(e)?n[0]:n[n.length-1]}const xo="http://www.w3.org/2000/svg",No=["user-annotations","user-highlights","other-content"];function Co(e,t){const n=function(e){
if(e.collapsed)return[];let t=e.commonAncestorContainer;if(t&&t.nodeType!==Node.ELEMENT_NODE&&(t=t.parentElement),!t)return[];const n=[],o=t.ownerDocument.createNodeIterator(t,NodeFilter.SHOW_TEXT);let i;for(;i=o.nextNode();){if(!wo(e,i))continue;const t=i;t===e.startContainer&&e.startOffset>0?t.splitText(e.startOffset):(t===e.endContainer&&e.endOffset<t.data.length&&t.splitText(e.endOffset),n.push(t))}return n}(e),o=n.length>0&&go(n[0]);let i=[],r=null,s=null;n.forEach((e=>{r&&r.nextSibling===e?s.push(e):(s=[e],i.push(s)),r=e}));const a=/^\s*$/;i=i.filter((e=>{const t=e[0].parentElement;return 1===t?.childNodes.length&&"SPAN"===t?.tagName||e.some((e=>!a.test(e.data)))}));const l=[];return i.forEach((e=>{const n=document.createElement("hypothesis-highlight");n.className=Ae("hypothesis-highlight",t);e[0].parentNode.replaceChild(n,e[0]),e.forEach((e=>n.appendChild(e))),l.push(n)})),o||function(e,t){if(0===e.length)return;const n=function(e){const t=e.closest(".page");if(!t)return null
;return t.querySelector(".canvasWrapper > canvas")||null}(e[0]);if(!n||!n.parentElement)return;let o=n.parentElement.querySelector(".hypothesis-highlight-layer");if(!o){o=document.createElementNS(xo,"svg"),o.setAttribute("class","hypothesis-highlight-layer"),n.parentElement.appendChild(o),n.parentElement.style.position="relative";const e=o.style;e.position="absolute",e.left="0",e.top="0",e.width="100%",e.height="100%",e.mixBlendMode="multiply"}const i=n.getBoundingClientRect(),r=e.map((e=>{const n=e.getBoundingClientRect(),o=document.createElementNS(xo,"rect");return o.setAttribute("x",(n.left-i.left).toString()),o.setAttribute("y",(n.top-i.top).toString()),o.setAttribute("width",n.width.toString()),o.setAttribute("height",n.height.toString()),o.setAttribute("class",Ae("hypothesis-svg-highlight",t)),e.classList.add("is-transparent"),e.svgHighlight=o,o}));o.append(...r)}(l,t),l}function So(e,t){const n=e.parentNode;t.forEach((t=>n.insertBefore(t,e))),e.remove()}function Eo(e){ko(e,!1);for(const t of e){
if(t.parentNode){So(t,Array.from(t.childNodes))}t.svgHighlight&&t.svgHighlight.remove()}}function ko(e,t){e.forEach((e=>{e.svgHighlight?function(e,t){const n=e.parentNode,o=e.getAttribute("data-focused-id");if(Boolean(o)!==t)if(t){e.setAttribute("data-focused-id",en(8));const t=e.cloneNode();t.setAttribute("data-is-focused","data-is-focused"),n.append(t)}else{const t=n.querySelector(`[data-focused-id="${o}"][data-is-focused]`);t?.remove(),e.removeAttribute("data-focused-id")}}(e.svgHighlight,t):e.classList.toggle("hypothesis-highlight-focused",t)}))}function Ao(e){To(Po(e)),function(e){for(const[t,n]of function(e){const t=new Map;for(const n of(e??document).getElementsByClassName("hypothesis-highlight-layer"))t.set(n,Array.from(n.querySelectorAll(".hypothesis-svg-highlight")));return t}(e)){n.every(((e,t,n)=>0===t||Oo(e)>=Oo(n[t-1])))||(n.sort(((e,t)=>Oo(e)-Oo(t))),t.replaceChildren(...n))}}(e)}const Ro=e=>"hypothesis-highlight"===e.tagName.toLowerCase();function Po(e){let t
;return t=Ro(e)?Array.from(e.children).filter(Ro):Array.from(e.getElementsByTagName("hypothesis-highlight")).filter((e=>!e.parentElement||!Ro(e.parentElement))),t}function To(e,t="",n=0,o=0){for(const i of e){const e=No.find((e=>i.classList.contains(e)))??"other-content",r=t&&e===t?o+1:0;i.setAttribute("data-nesting-level",`${n}`),i.setAttribute("data-cluster-level",`${r}`),i.svgHighlight&&(i.svgHighlight.setAttribute("data-nesting-level",`${n}`),i.svgHighlight.setAttribute("data-cluster-level",`${r}`)),To(Po(i),e,n+1,r)}}function Oo(e){return e.getAttribute("data-is-focused")?Number.MAX_SAFE_INTEGER:parseInt(e.getAttribute("data-nesting-level")??"0",10)}function Lo(e){const t=[];return e.forEach((({annotation:e,highlights:n})=>{if(!n?.length)return;const{top:o,bottom:i}=function(e){const t=e.map((e=>e.getBoundingClientRect()));return t.reduce(((e,t)=>({top:Math.min(e.top,t.top),left:Math.min(e.left,t.left),bottom:Math.max(e.bottom,t.bottom),right:Math.max(e.right,t.right)})))}(n);o>=i||t.push({tag:e.$tag,
top:o,bottom:i})})),t.sort(((e,t)=>e.top-t.top)),t}class Mo{constructor({contentContainer:e,hostRPC:t}){this._hostRPC=t,this._updatePending=!1,this._anchors=[],this._listeners=new be,this._listeners.add(window,"resize",(()=>this.update())),this._listeners.add(window,"scroll",(()=>this.update())),this._listeners.add(e,"scroll",(()=>this.update()),{capture:!0})}destroy(){this._listeners.removeAll()}update(e){e&&(this._anchors=e),this._updatePending||(this._updatePending=!0,requestAnimationFrame((()=>{const e=Lo(this._anchors);this._hostRPC.call("anchorsChanged",e),this._updatePending=!1})))}}class Io extends CustomEvent{constructor(e){super("hypothesis:layoutchange",{bubbles:!0,cancelable:!1,detail:e})}}const Bo=new Set;function Fo(...e){const t=e.join();Bo.has(t)||(console.warn(...e),Bo.add(t))}Fo.reset=()=>{Bo.clear()};const Do=["styled_highlight_clusters"];class Ho extends an.TinyEmitter{constructor(e=Do){super(),this._flags=new Map,this._knownFlags=e}update(e){this._flags.clear()
;for(const[t,n]of Object.entries(e))this._flags.set(t,n);this.emit("flagsChanged")}flagEnabled(e){return this._knownFlags.includes(e)?this._flags.get(e)??!1:(Fo("Looked up unknown feature",e),!1)}allFlags(){return Object.fromEntries(this._flags)}}function Vo({cluster:e,label:t,onChange:n,currentStyles:o,highlightStyles:i}){const r=o[e],s="transparent"===r;return Pe("div",{className:"space-y-2",children:[Pe("div",{className:"flex items-center gap-x-2 text-annotator-base",children:Pe("div",{className:"grow text-color-text px-2 py-1 rounded",style:{backgroundColor:i[r].color},children:t})}),Pe("div",{className:"flex items-center gap-x-2",children:Object.keys(i).map((t=>Pe("div",{className:"relative",children:[Pe("input",{className:Ae("absolute w-6 h-6","opacity-[.00001]","cursor-pointer"),name:e,id:`hypothesis-${e}-${t}`,checked:r===t,onChange:n,type:"radio",value:t}),Pe("label",{className:"block",htmlFor:`${e}-${t}`,children:[Pe("div",{style:{backgroundColor:i[t].color},
className:Ae("block w-6 h-6 rounded-full flex items-center justify-center",{"border-2 border-slate-0":r!==t,"border-2 border-slate-3":r===t}),children:"transparent"===t&&Pe(nt,{className:Ae("w-3 h-3",{"text-slate-3":!s,"text-slate-7":s})})}),Pe("span",{className:"sr-only",children:t})]})]},`${e}-${t}`)))})]})}function Uo({active:e,availableStyles:t,currentStyles:n,onStyleChange:o}){const i=ae((e=>{const t=e.target,n=t.name,i=t.value;o(n,i)}),[o]),[r,s]=ne(!1);return e?Pe(Oe,{classes:"overflow-hidden",children:Pe("div",{className:"flex flex-col text-annotator-base text-color-text",children:[Pe(xt,{classes:"rounded-none","data-testid":"control-toggle-button",onClick:()=>s(!r),title:r?"Hide highlight settings":"Show highlight settings",children:Pe(x,r?{children:[Pe(Ve,{}),Pe("span",{children:"Highlight Appearance"})]}:{children:[Pe(We,{}),Pe(it,{})]})}),r&&Pe(Me,{"data-testid":"cluster-style-controls",size:"sm",children:[Pe(Vo,{highlightStyles:t,label:"My annotations",cluster:"user-annotations",onChange:i,
currentStyles:n}),Pe(Vo,{highlightStyles:t,label:"My highlights",cluster:"user-highlights",onChange:i,currentStyles:n}),Pe(Vo,{highlightStyles:t,label:"Everybody's content",cluster:"other-content",onChange:i,currentStyles:n})]})]})}):null}const qo={transparent:{color:"transparent",secondColor:"transparent",thirdColor:"transparent"},pink:{color:"var(--hypothesis-color-pink)",secondColor:"var(--hypothesis-color-pink-1)",thirdColor:"var(--hypothesis-color-pink-2)"},orange:{color:"var(--hypothesis-color-orange)",secondColor:"var(--hypothesis-color-orange-1)",thirdColor:"var(--hypothesis-color-orange-2)"},yellow:{color:"var(--hypothesis-color-yellow)",secondColor:"var(--hypothesis-color-yellow-1)",thirdColor:"var(--hypothesis-color-yellow-2)"},green:{color:"var(--hypothesis-color-green)",secondColor:"var(--hypothesis-color-green-1)",thirdColor:"var(--hypothesis-color-green-2)"},purple:{color:"var(--hypothesis-color-purple)",secondColor:"var(--hypothesis-color-purple-1)",
thirdColor:"var(--hypothesis-color-purple-2)"},grey:{color:"var(--hypothesis-color-grey)",secondColor:"var(--hypothesis-color-grey-1)",thirdColor:"var(--hypothesis-color-grey-2)"}},$o={"other-content":"yellow","user-annotations":"orange","user-highlights":"purple"};class Wo{constructor(e,t){this._element=e,this._features=t.features,this._container=new eo("highlight-cluster-toolbar",(()=>this._render())),this._element.appendChild(this._container.element),Object.assign(this._container.element.style,{position:"fixed",top:`${this._element.offsetTop+4}px`,left:"4px"}),this.appliedStyles=$o,this._init(),this._features.on("flagsChanged",(()=>{this._activate(this._isActive())})),this._container.render()}destroy(){clearTimeout(this._updateTimeout),this._activate(!1),this._container.destroy()}scheduleClusterUpdates(){clearTimeout(this._updateTimeout),this._updateTimeout=setTimeout((()=>this._updateClusters()),100)}_init(){for(const e of Object.keys(this.appliedStyles))this._setClusterStyles(e,this.appliedStyles[e])
;this._activate(this._isActive())}_updateClusters(){this._isActive()&&Ao(this._element)}_isActive(){return this._features.flagEnabled("styled_highlight_clusters")}_activate(e){this._element.classList.toggle("hypothesis-highlights-clustered",e),this._container.render()}_setClusterStyle(e,t){document.documentElement.style.setProperty(e,t)}_setClusterStyles(e,t){const n=qo[t];for(const t of Object.keys(n))this._setClusterStyle(`--hypothesis-${e}-${t}`,n[t])}_onChangeClusterStyle(e,t){this.appliedStyles[e]=t,this._setClusterStyles(e,t),this._container.render()}_render(){return Pe(Uo,{active:this._isActive(),availableStyles:qo,currentStyles:this.appliedStyles,onStyleChange:(e,t)=>this._onChangeClusterStyle(e,t)})}}function zo(e){return e.split("").reverse().join("")}function jo(e){return(e|-e)>>31&1}function Xo(e,t,n,o){let i=e.P[n],r=e.M[n];const s=o>>>31,a=t[n]|s,l=a|r,c=(a&i)+i^i|a;let d=r|~(c|i),u=i&c;const h=jo(d&e.lastRowMask[n])-jo(u&e.lastRowMask[n]);return d<<=1,u<<=1,u|=s,d|=jo(o)-s,i=u|~(l|d),r=d&l,
e.P[n]=i,e.M[n]=r,h}function Ko(e,t,n){if(0===t.length)return[];n=Math.min(n,t.length);const o=[],i=32,r=Math.ceil(t.length/i)-1,s={P:new Uint32Array(r+1),M:new Uint32Array(r+1),lastRowMask:new Uint32Array(r+1)};s.lastRowMask.fill(1<<31),s.lastRowMask[r]=1<<(t.length-1)%i;const a=new Uint32Array(r+1),l=new Map,c=[];for(let e=0;e<256;e++)c.push(a);for(let e=0;e<t.length;e+=1){const n=t.charCodeAt(e);if(l.has(n))continue;const o=new Uint32Array(r+1);l.set(n,o),n<c.length&&(c[n]=o);for(let e=0;e<=r;e+=1){o[e]=0;for(let r=0;r<i;r+=1){const s=e*i+r;if(s>=t.length)continue;t.charCodeAt(s)===n&&(o[e]|=1<<r)}}}let d=Math.max(0,Math.ceil(n/i)-1);const u=new Uint32Array(r+1);for(let e=0;e<=d;e+=1)u[e]=(e+1)*i;u[r]=t.length;for(let e=0;e<=d;e+=1)s.P[e]=-1,s.M[e]=0;for(let h=0;h<e.length;h+=1){const f=e.charCodeAt(h);let m;f<c.length?m=c[f]:(m=l.get(f),void 0===m&&(m=a));let g=0;for(let e=0;e<=d;e+=1)g=Xo(s,m,e,g),u[e]+=g;if(u[d]-g<=n&&d<r&&(1&m[d+1]||g<0)){let e;if(d+=1,s.P[d]=-1,s.M[d]=0,d===r){const n=t.length%i
;e=0===n?i:n}else e=i;u[d]=u[d-1]+e-g+Xo(s,m,d,g)}else for(;d>0&&u[d]>=n+i;)d-=1;d===r&&u[d]<=n&&(u[d]<n&&o.splice(0,o.length),o.push({start:-1,end:h+1,errors:u[d]}),n=u[d])}return o}function Qo(e,t,n){return function(e,t,n){const o=zo(t);return n.map((n=>{const i=Math.max(0,n.end-t.length-n.errors);return{start:Ko(zo(e.slice(i,n.end)),o,n.errors).reduce(((e,t)=>n.end-t.end<e?n.end-t.end:e),n.end),end:n.end,errors:n.errors}}))}(e,t,Ko(e,t,n))}function Go(e,t,n){let o=0;const i=[];for(;-1!==o;)o=e.indexOf(t,o),-1!==o&&(i.push({start:o,end:o+t.length,errors:0}),o+=1);return i.length>0?i:Qo(e,t,n)}function Yo(e,t){if(0===t.length||0===e.length)return 0;return 1-Go(e,t,t.length)[0].errors/t.length}function Jo(e,t,n={}){if(0===t.length)return null;const o=Math.min(256,t.length/2),i=Go(e,t,o);if(0===i.length)return null;const r=o=>{const i=1-o.errors/t.length,r=n.prefix?Yo(e.slice(Math.max(0,o.start-n.prefix.length),o.start),n.prefix):1,s=n.suffix?Yo(e.slice(o.end,o.end+n.suffix.length),n.suffix):1;let a=1
;if("number"==typeof n.hint){a=1-Math.abs(o.start-n.hint)/e.length}return(50*i+20*r+20*s+2*a)/92},s=i.map((e=>({start:e.start,end:e.end,score:r(e)})));return s.sort(((e,t)=>t.score-e.score)),s[0]}function Zo(e){const t=function(e){const t=e.nodeName.toLowerCase();return"#text"===t?"text()":t}(e),n=function(e){let t=0,n=e;for(;n;)n.nodeName===e.nodeName&&(t+=1),n=n.previousSibling;return t}(e);return`${t}[${n}]`}function ei(e,t){let n="",o=e;for(;o!==t;){if(!o)throw new Error("Node is not a descendant of root");n=Zo(o)+"/"+n,o=o.parentNode}return n="/"+n,n=n.replace(/\/$/,""),n}function ti(e,t,n){t=t.toUpperCase();let o=-1;for(let i=0;i<e.children.length;i++){const r=e.children[i];if(r.nodeName.toUpperCase()===t&&(++o,o===n))return r}return null}function ni(e,t=document.body){try{return function(e,t){if(null===e.match(/^(\/[A-Za-z0-9-]+(\[[0-9]+\])?)+$/))throw new Error("Expression is not a simple XPath");const n=e.split("/");let o=t;n.shift();for(const e of n){let t,n;const i=e.indexOf("[");if(-1!==i){
t=e.slice(0,i);const o=e.slice(i+1,e.indexOf("]"));if(n=parseInt(o)-1,n<0)return null}else t=e,n=0;const r=ti(o,t,n);if(!r)return null;o=r}return o}(e,t)}catch{return document.evaluate("."+e,t,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}class oi{constructor(e,t){this.root=e,this.range=t}static fromRange(e,t){return new oi(e,t)}static fromSelector(e,t){const n=ni(t.startContainer,e);if(!n)throw new Error("Failed to resolve startContainer XPath");const o=ni(t.endContainer,e);if(!o)throw new Error("Failed to resolve endContainer XPath");const i=ho.fromCharOffset(n,t.startOffset),r=ho.fromCharOffset(o,t.endOffset),s=new fo(i,r).toRange();return new oi(e,s)}toRange(){return this.range}toSelector(){const e=fo.fromRange(this.range).toRange(),t=fo.fromRange(e),n=ei(t.start.element,this.root),o=ei(t.end.element,this.root);return{type:"RangeSelector",startContainer:n,startOffset:t.start.offset,endContainer:o,endOffset:t.end.offset}}}class ii{constructor(e,t,n){this.root=e,this.start=t,this.end=n}
static fromRange(e,t){const n=fo.fromRange(t).relativeTo(e);return new ii(e,n.start.offset,n.end.offset)}static fromSelector(e,t){return new ii(e,t.start,t.end)}toSelector(){return{type:"TextPositionSelector",start:this.start,end:this.end}}toRange(){return fo.fromOffsets(this.root,this.start,this.end).toRange()}}class ri{constructor(e,t,n={}){this.root=e,this.exact=t,this.context=n}static fromRange(e,t){const n=e.textContent,o=fo.fromRange(t).relativeTo(e),i=o.start.offset,r=o.end.offset;return new ri(e,n.slice(i,r),{prefix:n.slice(Math.max(0,i-32),i),suffix:n.slice(r,Math.min(n.length,r+32))})}static fromSelector(e,t){const{prefix:n,suffix:o}=t;return new ri(e,t.exact,{prefix:n,suffix:o})}toSelector(){return{type:"TextQuoteSelector",exact:this.exact,prefix:this.context.prefix,suffix:this.context.suffix}}toRange(e={}){return this.toPositionAnchor(e).toRange()}toPositionAnchor(e={}){const t=Jo(this.root.textContent,this.exact,{...this.context,hint:e.hint});if(!t)throw new Error("Quote not found")
;return new ii(this.root,t.start,t.end)}}function si(e){const t=parseFloat(e);return!Number.isFinite(t)||t<0?null:t}function ai(e){return e instanceof Element?e:e.parentElement}function li(e,t=e){const n=si(e?.getAttribute("data-time-start")??""),o=si(t?.getAttribute("data-time-end")??"");return"number"!=typeof n||"number"!=typeof o||o<n?null:[n,o]}class ci{constructor(e,t,n){this.root=e,this.start=t,this.end=n}static fromRange(e,t){const n=ai(t.startContainer)?.closest("[data-time-start]"),o=ai(t.endContainer)?.closest("[data-time-end]"),i=li(n,o);if(!i)return null;const[r,s]=i;return new ci(e,r,s)}toRange(){const e=[...this.root.querySelectorAll("[data-time-start]")].map((e=>{const t=li(e);if(!t)return null;const[n,o]=t;return{element:e,start:n,end:o}})).filter((e=>null!==e));e.sort(((e,t)=>e.start-t.start));const t=function(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}(e,(e=>e.start<=this.start&&e.end>=this.start));if(-1===t)throw new Error("Start segment not found")
;const n=t+e.slice(t).findIndex((e=>e.start<=this.end&&e.end>=this.end));if(-1===n)throw new Error("End segment not found");const o=new Range;o.setStart(e[t].element,0);const i=e[n].element;return o.setEnd(i,i.childNodes.length),o}static fromSelector(e,t){const{start:n,end:o}=t;return new ci(e,n,o)}toSelector(){return{type:"MediaTimeSelector",start:this.start,end:this.end}}}async function di(e,t){return e.toRange(t)}function ui(e,t,n){const o=e[t];if("function"!=typeof o)throw new Error("Can only intercept functions");return e[t]=(...t)=>{const i=o.call(e,...t);return n(...t),i},()=>{e[t]=o}}function hi(e){return e.replace(/#.*/,"")}class fi{constructor(e,t=(()=>location.href)){this._listeners=new be;let n=t();const o=(o=t())=>{hi(n)!==hi(o)&&(n=o,e(o))},i=function(){const e=window.navigation;return"function"==typeof Navigation&&e instanceof Navigation?e:null}();if(i)this._listeners.add(i,"navigatesuccess",(()=>o()));else{
const e=[ui(window.history,"pushState",(()=>o())),ui(window.history,"replaceState",(()=>o()))];this._unpatchHistory=()=>e.forEach((e=>e())),this._listeners.add(window,"popstate",(()=>o()))}}disconnect(){this._unpatchHistory?.(),this._listeners.removeAll()}}var mi,gi;var pi=function(){if(gi)return mi;gi=1;var e="complete",t="canceled";function n(e,t,n){e.self===e?e.scrollTo(t,n):(e.scrollLeft=t,e.scrollTop=n)}function o(t){var i=t._scrollSettings;if(i){var r=i.maxSynchronousAlignments,s=function(e,t){var n,o,i,r,s,a,l,c=e.align,d=e.target.getBoundingClientRect(),u=c&&null!=c.left?c.left:.5,h=c&&null!=c.top?c.top:.5,f=c&&null!=c.leftOffset?c.leftOffset:0,m=c&&null!=c.topOffset?c.topOffset:0,g=u,p=h;if(e.isWindow(t))a=Math.min(d.width,t.innerWidth),l=Math.min(d.height,t.innerHeight),o=d.left+t.pageXOffset-t.innerWidth*g+a*g,i=d.top+t.pageYOffset-t.innerHeight*p+l*p,o-=f,i-=m,o=e.align.lockX?t.pageXOffset:o,i=e.align.lockY?t.pageYOffset:i,r=o-t.pageXOffset,s=i-t.pageYOffset;else{a=d.width,l=d.height,
n=t.getBoundingClientRect();var _=d.left-(n.left-t.scrollLeft),b=d.top-(n.top-t.scrollTop);o=_+a*g-t.clientWidth*g,i=b+l*p-t.clientHeight*p,o-=f,i-=m,o=Math.max(Math.min(o,t.scrollWidth-t.clientWidth),0),i=Math.max(Math.min(i,t.scrollHeight-t.clientHeight),0),o=e.align.lockX?t.scrollLeft:o,i=e.align.lockY?t.scrollTop:i,r=o-t.scrollLeft,s=i-t.scrollTop}return{x:o,y:i,differenceX:r,differenceY:s}}(i,t),a=Date.now()-i.startTime,l=Math.min(1/i.time*a,1);if(i.endIterations>=r)return n(t,s.x,s.y),t._scrollSettings=null,i.end(e);var c=1-i.ease(l);if(n(t,s.x-s.differenceX*c,s.y-s.differenceY*c),a>=i.time)return i.endIterations++,i.scrollAncestor&&o(i.scrollAncestor),void o(t);!function(e){if("requestAnimationFrame"in window)return window.requestAnimationFrame(e);setTimeout(e,16)}(o.bind(null,t))}}function i(e){return e.self===e}function r(e){return"pageXOffset"in e||(e.scrollHeight!==e.clientHeight||e.scrollWidth!==e.clientWidth)&&"hidden"!==getComputedStyle(e).overflow}function s(){return!0}function a(e){
if(e.assignedSlot)return a(e.assignedSlot);if(e.parentElement)return"body"===e.parentElement.tagName.toLowerCase()?e.parentElement.ownerDocument.defaultView||e.parentElement.ownerDocument.ownerWindow:e.parentElement;if(e.getRootNode){var t=e.getRootNode();if(11===t.nodeType)return t.host}}return mi=function(n,l,c){if(n){"function"==typeof l&&(c=l,l=null),l||(l={}),l.time=isNaN(l.time)?1e3:l.time,l.ease=l.ease||function(e){return 1-Math.pow(1-e,e/2)},l.align=l.align||{};var d=a(n),u=1,h=l.validTarget||s,f=l.isScrollable;l.debug&&(console.log("About to scroll to",n),d||console.error("Target did not have a parent, is it mounted in the DOM?"));for(var m=[];d;)if(l.debug&&console.log("Scrolling parent node",d),h(d,u)&&(f?f(d,r):r(d))&&(u++,m.push(d)),!(d=a(d))){g(e);break}return m.reduce(((e,r,s)=>function(e,n,r,s,a){var l,c=!n._scrollSettings,d=n._scrollSettings,u=Date.now(),h={passive:!0};function f(e){n._scrollSettings=null,
n.parentElement&&n.parentElement._scrollSettings&&n.parentElement._scrollSettings.end(e),r.debug&&console.log("Scrolling ended with type",e,"for",n),a(e),l&&(n.removeEventListener("touchstart",l,h),n.removeEventListener("wheel",l,h))}d&&d.end(t);var m=r.maxSynchronousAlignments;return null==m&&(m=3),n._scrollSettings={startTime:u,endIterations:0,target:e,time:r.time,ease:r.ease,align:r.align,isWindow:r.isWindow||i,maxSynchronousAlignments:m,end:f,scrollAncestor:s},"cancellable"in r&&!r.cancellable||(l=f.bind(null,t),n.addEventListener("touchstart",l,h),n.addEventListener("wheel",l,h)),c&&o(n),l}(n,r,l,m[s+1],g)),null)}function g(e){--u||c&&c(e)}},mi}(),_i=t(pi);function bi(e,t,n){return e+n*(t-e)}async function wi(e,t,{maxDuration:n=500}={}){const o=e.scrollTop,i=t,r=Date.now(),s=Math.min(Math.abs(i-o)/3,n);let a=0;for(;a<1;)await new Promise((e=>{requestAnimationFrame(e)})),a=Math.min(1,(Date.now()-r)/s),e.scrollTop=bi(o,i,a)}function vi(e,t=document.baseURI){
return new URL(e,t).href.toString().replace(/#.*/,"")}class yi{constructor(e={}){this.document=e.document||document}uri(){let e=this._getDocumentHref();try{e=decodeURIComponent(e)}catch(e){console.error("Error decoding URI:",e)}const t=this._getLinks();for(const n of t)"canonical"===n.rel&&(e=n.href);return e}getDocumentMetadata(){const e={title:document.title,link:[],dc:this._getMetaTags("name","dc."),eprints:this._getMetaTags("name","eprints."),facebook:this._getMetaTags("property","og:"),highwire:this._getMetaTags("name","citation_"),prism:this._getMetaTags("name","prism."),twitter:this._getMetaTags("name","twitter:")},t=this._getFavicon();t&&(e.favicon=t),e.title=this._getTitle(e),e.link=this._getLinks(e);const n=e.link.find((e=>e.href.startsWith("urn:x-dc")));return n&&(e.documentFingerprint=n.href),e}_getMetaTags(e,t){const n={};for(const o of Array.from(this.document.querySelectorAll("meta"))){const i=o.getAttribute(e),{content:r}=o;if(i&&r){const e=i.match(RegExp(`^${t}(.+)$`,"i"));if(e){
const t=e[1].toLowerCase();n[t]?n[t].push(r):n[t]=[r]}}}return n}_getTitle(e){return e.highwire.title?e.highwire.title[0]:e.eprints.title?e.eprints.title[0]:e.prism.title?e.prism.title[0]:e.facebook.title?e.facebook.title[0]:e.twitter.title?e.twitter.title[0]:e.dc.title?e.dc.title[0]:this.document.title}_getLinks(e={dc:{},highwire:{}}){const t=[{href:this._getDocumentHref()}],n=Array.from(this.document.querySelectorAll("link"));for(const e of n)if(["alternate","canonical","bookmark","shortlink"].includes(e.rel)){if("alternate"===e.rel){if(e.type&&e.type.match(/^application\/(rss|atom)\+xml/))continue;if(e.hreflang)continue}try{const n=this._absoluteUrl(e.href);t.push({href:n,rel:e.rel,type:e.type})}catch{}}for(const n of Object.keys(e.highwire)){const o=e.highwire[n];if("pdf_url"===n)for(const e of o)try{t.push({href:this._absoluteUrl(e),type:"application/pdf"})}catch{}if("doi"===n)for(let e of o)"doi:"!==e.slice(0,4)&&(e=`doi:${e}`),t.push({href:e})}for(const n of Object.keys(e.dc)){const o=e.dc[n]
;if("identifier"===n)for(const e of o)"doi:"===e.slice(0,4)&&t.push({href:e})}const o=e.dc["relation.ispartof"],i=e.dc.identifier;if(o&&i){const e=o[o.length-1],n=i[i.length-1],r="urn:x-dc:"+encodeURIComponent(e)+"/"+encodeURIComponent(n);t.push({href:r})}return t}_getFavicon(){let e=null;for(const t of Array.from(this.document.querySelectorAll("link")))if(["shortcut icon","icon"].includes(t.rel))try{e=this._absoluteUrl(t.href)}catch{}return e}_absoluteUrl(e){return vi(e,this.document.baseURI)}_getDocumentHref(){const{href:e}=this.document.location,t=["http:","https:","file:"],n=new URL(e).protocol;return t.includes(n)?e:this.document.baseURI&&t.includes(new URL(this.document.baseURI).protocol)?this.document.baseURI:e}}class xi extends an.TinyEmitter{constructor({features:e,container:t=document.body,sideBySideOptions:n}){super(),this.features=e,this.container=t,this._htmlMeta=new yi,this._prevURI=this._htmlMeta.uri(),this._sideBySideEnabled=!0,this._sideBySideOptions=n??{mode:"auto"},
this._sideBySideActive=!1,this._lastLayout=null,this._navObserver=new fi((()=>this._checkForURIChange())),this._metaObserver=new MutationObserver((()=>this._checkForURIChange())),this._metaObserver.observe(document.head,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["rel","href","name","content"]}),this._flagsChanged=()=>{},this.features.on("flagsChanged",this._flagsChanged)}anchor(e,t){return function(e,t,n={}){let o=null,i=null,r=null,s=null;for(const e of t)switch(e.type){case"TextPositionSelector":i=e,n.hint=i.start;break;case"TextQuoteSelector":r=e;break;case"RangeSelector":s=e;break;case"MediaTimeSelector":o=e}const a=e=>{if(r?.exact&&e.toString()!==r.exact)throw new Error("quote mismatch");return e};let l=Promise.reject("unable to anchor");if(s){const t=s;l=l.catch((()=>di(oi.fromSelector(e,t),n).then(a)))}if(i){const t=i;l=l.catch((()=>di(ii.fromSelector(e,t),n).then(a)))}if(r){const t=r;l=l.catch((()=>di(ri.fromSelector(e,t),n)))}if(o){const t=o
;l=l.catch((()=>ci.fromSelector(e,t).toRange()))}return l}(e,t)}describe(e,t){return function(e,t){const n=[ci,oi,ii,ri],o=[];for(const i of n)try{const n=i.fromRange(e,t);n&&o.push(n.toSelector())}catch{}return o}(e,t)}_checkForURIChange(){const e=this._htmlMeta.uri();e!==this._prevURI&&(this._prevURI=e,this.emit("uriChanged",e))}getAnnotatableRange(e){try{return fo.trimmedRange(e)}catch(e){if(e instanceof RangeError)return null;throw e}}canStyleClusteredHighlights(){return!0}destroy(){this._deactivateSideBySide(),this._navObserver.disconnect(),this._metaObserver.disconnect(),this.features.off("flagsChanged",this._flagsChanged)}contentContainer(){return this.container}fitSideBySide(e){this._lastLayout=e;const t=window.innerWidth-e.width,n=this._sideBySideEnabled&&"auto"===this._sideBySideOptions.mode&&e.expanded&&t>=480;return n?this._activateSideBySide(e.width):this._sideBySideActive&&this._deactivateSideBySide(),this._sideBySideActive=n,
this.container.classList.toggle("hypothesis-sidebyside-active",this._sideBySideActive),n}sideBySideActive(){return this._sideBySideActive}_activateSideBySide(e){const t=e+12,n=e=>parseInt(window.getComputedStyle(e).marginLeft,10);Fn((()=>{document.body.style.marginLeft="",document.body.style.marginRight="";const e=n(document.body);document.body.style.marginRight=`${t}px`;const o=function(e){const t=new Map,n=new Map,o=Tn.join(","),i=Array.from(e.querySelectorAll(o)).map((e=>({rect:e.getBoundingClientRect(),textLength:e.textContent.length}))).filter((({rect:e})=>e.width>0&&e.height>0)).sort(((e,t)=>t.textLength-e.textLength)).slice(0,15);if(i.forEach((({rect:e})=>{let o=t.get(e.left)??0;o+=1,t.set(e.left,o);let i=n.get(e.right)??0;i+=1,n.set(e.right,i)})),0===t.size||0===n.size)return null;const r=[...t.entries()].sort(((e,t)=>t[1]-e[1])),s=[...n.entries()].sort(((e,t)=>t[1]-e[1])),[a]=r[0],[l]=s[0];return{left:a,right:l}}(document.body);if(o){const i=Math.max(0,window.innerWidth-t-o.right);if(i>0){
const e=Math.max(0,t-i);document.body.style.marginRight=`${e}px`}n(document.body)>e&&(document.body.style.marginLeft=`${e}px`),o.left<12&&(document.body.style.marginLeft="12px")}else document.body.style.marginLeft="",document.body.style.marginRight=""}))}_deactivateSideBySide(){Fn((()=>{document.body.style.marginLeft="",document.body.style.marginRight=""}))}async getMetadata(){return this._htmlMeta.getDocumentMetadata()}async uri(){return this._htmlMeta.uri()}async scrollToAnchor(e){const t=e.highlights?.[0];t&&await async function(e,{maxDuration:t=500}={}){const n=e.closest("body");n&&"BODY"!==n.tagName&&Object.defineProperty(n,"tagName",{value:"BODY",configurable:!0});const o=e.closest("details");o&&!o.hasAttribute("open")&&(o.open=!0),await new Promise((n=>_i(e,{time:t},n)))}(t)}}var Ni,Ci;var Si=function(){if(Ci)return Ni;Ci=1
;var t=NaN,n="[object Symbol]",o=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,r=/^0b[01]+$/i,s=/^0o[0-7]+$/i,a=parseInt,l="object"==typeof e&&e&&e.Object===Object&&e,c="object"==typeof self&&self&&self.Object===Object&&self,d=l||c||Function("return this")(),u=Object.prototype.toString,h=Math.max,f=Math.min,m=function(){return d.Date.now()};function g(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function p(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&u.call(e)==n}(e))return t;if(g(e)){var l="function"==typeof e.valueOf?e.valueOf():e;e=g(l)?l+"":l}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var c=r.test(e);return c||s.test(e)?a(e.slice(2),c?2:8):i.test(e)?t:+e}return Ni=function(e,t,n){var o,i,r,s,a,l,c=0,d=!1,u=!1,_=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function b(t){var n=o,r=i;return o=i=void 0,c=t,s=e.apply(r,n)}function w(e){var n=e-l;return void 0===l||n>=t||n<0||u&&e-c>=r}
function v(){var e=m();if(w(e))return y(e);a=setTimeout(v,function(e){var n=t-(e-l);return u?f(n,r-(e-c)):n}(e))}function y(e){return a=void 0,_&&o?b(e):(o=i=void 0,s)}function x(){var e=m(),n=w(e);if(o=arguments,i=this,l=e,n){if(void 0===a)return function(e){return c=e,a=setTimeout(v,t),d?b(e):s}(l);if(u)return a=setTimeout(v,t),b(l)}return void 0===a&&(a=setTimeout(v,t)),s}return t=p(t)||0,g(n)&&(d=!!n.leading,r=(u="maxWait"in n)?h(p(n.maxWait)||0,t):r,_="trailing"in n?!!n.trailing:_),x.cancel=function(){void 0!==a&&clearTimeout(a),c=0,o=l=i=a=void 0},x.flush=function(){return void 0===a?s:y(m())},x},Ni}(),Ei=t(Si);function ki(e,t,n,o=0){let i=o;for(;i<e.length&&t>0;)n(e[i])&&--t,++i;return i}function Ai(e,t,n,o){let i=0;for(let r=n;r<o;r++)t(e[r])&&++i;return i}function Ri(e,t,n,o,i){const r=Ai(e,i,0,n),s=Ai(e,i,n,o);let a=ki(t,r,i);for(;a<t.length&&!i(t[a]);)++a;return[a,ki(t,s,i,a)]}const Pi={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3},Ti=new Map,Oi=new Map;function Li(e,t){return`${e}:${t}`}function Mi(e){
const t="closest"in e?e:e.parentElement;return t?.closest(".textLayer")??null}function Ii(){return PDFViewerApplication.pdfViewer}async function Bi(e){const t=Ii();let n=t.getPageView(e);return n&&n.pdfPage||(n=await new Promise((n=>{const o=()=>{t.eventBus?t.eventBus.off("pagesloaded",o):document.removeEventListener("pagesloaded",o),n(t.getPageView(e))};t.eventBus?t.eventBus.on("pagesloaded",o):document.addEventListener("pagesloaded",o)}))),n}function Fi(e){const t=Ti.get(e);if(t)return t;const n=(async()=>{const t=await Bi(e);return(await t.pdfPage.getTextContent({normalizeWhitespace:!0})).items.map((e=>e.str)).join("")})();return Ti.set(e,n),n}async function Di(e){const t=Ii();let n=0,o=0,i="";for(let r=0;r<t.pagesCount;r++)if(i=await Fi(r),n=o,o+=i.length,o>=e)return{index:r,offset:n,text:i};return{index:t.pagesCount-1,offset:n,text:i}}function Hi(e){switch(e){case" ":case"\f":case"\n":case"\r":case"\t":case"\v":case"":return!0;default:return!1}}const Vi=e=>!Hi(e);function Ui(e){
return void 0!==e.renderingDone?e.renderingDone:!!e.div&&null!==e.div.querySelector(".endOfContent")}async function qi(e,t,n){const[o,i]=await Promise.all([Bi(e),Fi(e)]);if(o.renderingState===Pi.FINISHED&&o.textLayer&&Ui(o.textLayer)){const e=o.textLayer.textLayerDiv??o.textLayer.div;if(!e)throw new Error("Unable to find PDF.js text layer root");const r=e.textContent,[s,a]=Ri(i,r,t,n,Vi);$i(r.slice(s,a))!==$i(i.slice(t,n))&&Fo("Text layer text does not match page text. Highlights will be mis-aligned.");const l=new ho(e,s),c=new ho(e,a);return new fo(l,c).toRange()}const r=function(e){let t=e.querySelector(mo);return t||(t=document.createElement("span"),t.classList.add("annotator-placeholder"),t.textContent="Loading annotations...",e.appendChild(t),t)}(o.div),s=document.createRange();return s.setStartBefore(r),s.setEndAfter(r),s}function $i(e){let t="";for(let n=0;n<e.length;n++){const o=e[n];Hi(o)||(t+=o)}return t}async function Wi(e,t){const n=t.find((e=>"TextQuoteSelector"===e.type))
;if(!n)throw new Error("No quote selector found");const o=t.find((e=>"TextPositionSelector"===e.type));if(o){try{const{index:e,offset:t,text:i}=await Di(o.start),r=o.start-t,s=o.end-t,a=i.substring(r,s);if(n.exact!==a)throw new Error("quote mismatch");return await qi(e,r,s)}catch{}try{const e=Li(n.exact,o.start),t=Oi.get(e);if(t){const{pageIndex:e,anchor:n}=t;return await qi(e,n.start,n.end)}}catch{}}return async function(e,t){const n=Ii().pagesCount,o=Array(n).fill(0).map(((e,t)=>t));let i,r;if(t){const{index:e,offset:n}=await Di(t);i=e,r=t-n,o.sort(((t,n)=>Math.abs(t-e)-Math.abs(n-e)))}const s=void 0!==e.prefix?$i(e.prefix):void 0,a=void 0!==e.suffix?$i(e.suffix):void 0,l=$i(e.exact);let c;for(const e of o){const t=await Fi(e),n=$i(t);let o;void 0!==i&&void 0!==r&&(e<i?o=n.length:e===i?[o]=Ri(t,n,r,r,Vi):o=0);const d=Jo(n,l,{prefix:s,suffix:a,hint:o});if(d&&(!c||d.score>c.match.score)){const[o,i]=Ri(n,t,d.start,d.end,Vi);c={page:e,match:{start:o,end:i,score:d.score}}
;const r=n.slice(d.start,d.end)===l,u=void 0!==s&&n.slice(Math.max(0,d.start-s.length),d.start)===s,h=void 0!==a&&n.slice(d.end,a.length)===a;if(r&&(u||h||void 0===s&&void 0===a))break}}if(c){const{page:n,match:o}=c;if(t){const i=Li(e.exact,t);Oi.set(i,{pageIndex:n,anchor:o})}return qi(n,o.start,o.end)}throw new Error("Quote not found")}(n,o?.start)}function zi(e){try{e=fo.fromRange(e).toRange()}catch{throw new Error("Selection does not contain text")}const t=Mi(e.startContainer),n=Mi(e.endContainer);if(!t||!n)throw new Error("Selection is outside page text");if(t!==n)throw new Error("Selecting across page breaks is not supported");return[e,t]}async function ji(e,t){const[n,o]=zi(t),i=ho.fromPoint(n.startContainer,n.startOffset).relativeTo(o),r=ho.fromPoint(n.endContainer,n.endOffset).relativeTo(o),s=function(e){let t=0;for(;e.previousSibling;)++t,e=e.previousSibling;return t}(o.parentNode),a=s+1,l=await async function(e){if(e>=Ii().pagesCount)throw new Error("Invalid page index");let t=0
;for(let n=0;n<e;n++)t+=(await Fi(n)).length;return t}(s),c=await Bi(s);return[{type:"TextPositionSelector",start:l+i.offset,end:l+r.offset},ri.fromRange(e,n).toSelector(),{type:"PageSelector",index:s,label:c.pageLabel??a.toString()}]}function Xi({children:e}){return Pe("div",{className:"flex flex-col",children:e})}function Ki({info:e}){let t=e.item.title;return e.item.subtitle&&(t+=`: ${e.item.subtitle}`),Pe("div",{className:Ae("h-10 bg-white px-4 text-slate-7 text-annotator-base border-b","grid items-center","grid-cols-[100px_minmax(0,auto)]","2xl:grid-cols-[100px_minmax(0,auto)_minmax(0,auto)] 2xl:gap-x-3"),children:[Pe("div",{"data-testid":"content-logo",children:e.logo&&Pe(Gt,{href:e.logo.link,target:"_blank","data-testid":"logo-link",underline:"none",children:Pe("img",{alt:e.logo.title,src:e.logo.logo,"data-testid":"logo-image"})})}),Pe("div",{className:Ae("hidden","2xl:block 2xl:whitespace-nowrap 2xl:overflow-hidden 2xl:text-ellipsis","font-semibold"),"data-testid":"content-container-info",
title:e.container.title,children:e.container.title}),Pe("div",{className:Ae("flex justify-center items-center gap-x-2"),"data-testid":"content-item-info",children:[Pe("div",{className:Ae("hidden","2xl:block 2xl:grow")}),e.links.previousItem&&Pe(x,{children:[Pe(Gt,{title:"Open previous item",href:e.links.previousItem,underline:"always",target:"_blank","data-testid":"content-previous-link",children:Pe("div",{className:"flex gap-x-1 items-center text-annotator-sm whitespace-nowrap",children:[Pe(qe,{className:"w-em h-em"}),Pe("span",{children:"Previous"})]})}),Pe("div",{className:"text-annotator-sm",children:"|"})]}),Pe("div",{className:Ae("min-w-0 whitespace-nowrap overflow-hidden text-ellipsis shrink font-medium"),children:Pe(Gt,{title:t,href:e.links.currentItem,"data-testid":"content-item-link",target:"_blank",unstyled:!0,children:t})}),e.links.nextItem&&Pe(x,{children:[Pe("div",{className:"text-annotator-sm",children:"|"}),Pe(Gt,{title:"Open next item",href:e.links.nextItem,underline:"always",target:"_blank",
"data-testid":"content-next-link",children:Pe("div",{className:"flex gap gap-x-1 items-center text-annotator-sm whitespace-nowrap",children:[Pe("span",{children:"Next"}),Pe(We,{className:"w-em h-em"})]})})]})]})]})}function Qi(){return Pe("div",{className:"bg-white",role:"alert",children:Pe("div",{className:Ae("flex items-center gap-x-2","border border-yellow-notice bg-yellow-notice/10 text-annotator-base"),children:[Pe("div",{className:"bg-yellow-notice text-white p-2",children:Pe(je,{className:"text-annotator-xl"})}),Pe("div",{children:[Pe("strong",{children:"This PDF does not contain selectable text:"})," ",Pe(Gt,{target:"_blank",href:"https://web.hypothes.is/help/how-to-ocr-optimize-pdfs/",underline:"always",children:"Learn how to fix this"})," ","in order to annotate with Hypothesis."]})]})})}class Gi{constructor(e){this._loaded=function(e){return e.initializedPromise?e.initializedPromise:e.initialized?Promise.resolve():new Promise((t=>{const n=setInterval((()=>{e.initialized&&(clearTimeout(n),t())}),5)
}))}(e).then((async()=>{const t=await async function(e){return void 0!==e.downloadComplete?e.downloadComplete:(await e.pdfDocument.getDownloadInfo(),!0)}(e);return t?e:new Promise((t=>{const n=()=>{e.eventBus?(e.eventBus.off("documentload",n),e.eventBus.off("documentloaded",n)):window.removeEventListener("documentload",n),t(e)};e.eventBus?(e.eventBus.on("documentloaded",n),e.eventBus.on("documentload",n)):window.addEventListener("documentload",n)}))}))}getUri(){return this._loaded.then((e=>{let t=Zi(e);return t||(t=Ji(Yi(e))),t}))}async getMetadata(){const e=await this._loaded,{info:t,contentDispositionFilename:n,metadata:o}=await e.pdfDocument.getMetadata(),i=Yi(e),r=Zi(e);let s;s=o?.has("dc:title")&&"Untitled"!==o.get("dc:title")?o.get("dc:title"):t?.Title?t.Title:n||(r?function(e){const t=new URL(e),n=t.pathname.split("/");return n[n.length-1]}(r):"");const a=[{href:Ji(i)}];return r&&a.push({href:r}),{title:s,link:a,documentFingerprint:i}}}function Yi(e){
return Array.isArray(e.pdfDocument.fingerprints)?e.pdfDocument.fingerprints[0]:e.pdfDocument.fingerprint}function Ji(e){return`urn:x-pdf:${e}`}function Zi(e){if(!e.url)return null;const t=vi(e.url);return 0!==t.indexOf("file://")?t:null}function er(e){const t=e.highlights?.[0];return t&&go(t)}function tr(e){return new Promise((t=>setTimeout(t,e)))}class nr{constructor(){this._pdfjsContainer=document.querySelector("#outerContainer"),this._contentInfo=null,this._noTextWarning=!1,this._container=null}setContentInfo(e){this._contentInfo=e,this._update()}showNoTextWarning(e){this._noTextWarning=e,this._update()}destroy(){this._container?.destroy()}_update(){if(!(this._noTextWarning||this._contentInfo))return this._container?.destroy(),this._container=null,void(this._pdfjsContainer.style.height="");this._container||(this._container=new eo("banner",(()=>this._render())),document.body.prepend(this._container.element)),this._container.render();const e=this._container.element.getBoundingClientRect().height
;this._pdfjsContainer.style.height=`calc(100% - ${e}px)`}_render(){return Pe(Xi,{children:[this._contentInfo&&Pe(Ki,{info:this._contentInfo}),this._noTextWarning&&Pe(Qi,{})]})}}class or extends an.TinyEmitter{constructor(e,t={}){super(),this._annotator=e;const n=window,o=n.PDFViewerApplication;this._pdfViewer=o.pdfViewer,this._pdfViewer.viewer.classList.add("has-transparent-text-layer"),this._pdfContainer=o.appConfig?.appContainer??document.body,this._pdfMetadata=new Gi(o),this._observer=new MutationObserver(Ei((()=>this._update()),100)),this._observer.observe(this._pdfViewer.viewer,{attributes:!0,attributeFilter:["data-loaded"],childList:!0,subtree:!0}),this._reanchoringMaxWait=t.reanchoringMaxWait??3e3,this._banner=new nr,this._checkForSelectableText(),this._sideBySideActive=!1,this._updateAnnotationLayerVisibility=()=>{const e=n.getSelection();this._pdfViewer.viewer.classList.toggle("is-selecting",!e.isCollapsed)},this._listeners=new be,
this._listeners.add(document,"selectionchange",this._updateAnnotationLayerVisibility),this._destroyed=!1}destroy(){this.fitSideBySide({expanded:!1,width:0,toolbarWidth:0,height:window.innerHeight}),this._listeners.removeAll(),this._pdfViewer.viewer.classList.remove("has-transparent-text-layer"),this._observer.disconnect(),this._banner.destroy(),this._destroyed=!0}uri(){return this._pdfMetadata.getUri()}getMetadata(){return this._pdfMetadata.getMetadata()}showContentInfo(e){this._banner.setContentInfo(e)}anchor(e,t){return Wi(0,t)}getAnnotatableRange(e){try{const t=fo.trimmedRange(e);if(function(e){try{return zi(e),!0}catch{return!1}}(t))return t}catch(e){if(!(e instanceof RangeError))throw e}return null}canStyleClusteredHighlights(){return!0}describe(e,t){return ji(e,t)}async _checkForSelectableText(){try{await this.uri()}catch{return}if(!this._destroyed)try{const e=await async function(){const e=Ii();let t=!1;for(let n=0;n<e.pagesCount;n++)if((await Fi(n)).trim().length>0){t=!0;break}return t}()
;this._banner.showNoTextWarning(!e)}catch(e){console.warn("Unable to check for text in PDF:",e)}}_update(){const e=[],t=this._pdfViewer.pagesCount;for(let e=0;e<t;e++){const t=this._pdfViewer.getPageView(e);if(t?.textLayer&&Ui(t.textLayer))switch(t.renderingState){case Pi.INITIAL:t.textLayer=null;break;case Pi.FINISHED:n=t.div,n.querySelector(mo)?.remove()}}var n;for(const t of this._annotator.anchors)if(t.highlights){if(e.includes(t.annotation))continue;for(let n=0;n<t.highlights.length;n++){const o=t.highlights[n];if(!document.body.contains(o)){t.highlights.splice(n,1),delete t.range,e.push(t.annotation);break}}}e.map((e=>this._annotator.anchor(e)))}contentContainer(){return document.querySelector("#viewerContainer")}fitSideBySide(e){const t=window.innerWidth-e.width,n=e.expanded&&t>=680,o=n?e.width:e.toolbarWidth;this._pdfContainer.style.width=`calc(100% - ${o}px)`;const i=this._pdfViewer.currentScaleValue;return"auto"!==i&&"page-fit"!==i&&"page-width"!==i||(this._pdfViewer.currentScaleValue=i),
this._pdfViewer.update(),this._sideBySideActive=n,n}sideBySideActive(){return this._sideBySideActive}async scrollToAnchor(e){const t=e.annotation,n=er(e),o=this._anchorOffset(e);if(null!==o&&(await wi(this.contentContainer(),o),n)){const e=await this._waitForAnnotationToBeAnchored(t,this._reanchoringMaxWait);if(!e)return;const n=this._anchorOffset(e);if(null===n)return;await wi(this.contentContainer(),n)}}async _waitForAnnotationToBeAnchored(e,t){const n=Date.now();let o;do{o=this._annotator.anchors.find((t=>t.annotation===e)),o&&!er(o)||(o=null,await tr(20))}while(!o&&Date.now()-n<t);return o??null}_anchorOffset(e){if(!e.highlights)return null;return function(e,t){let n=0;for(;e!==t&&t.contains(e);)n+=e.offsetTop,e=e.offsetParent;return n}(e.highlights[0],this.contentContainer())}}function ir(e){if(!e.includes("["))return e;let t="",n=!1,o=!1;for(const i of e)n||"^"!==i?(n||"["!==i?!n&&o&&"]"===i?o=!1:o||(t+=i):o=!0,n=!1):n=!0;return t}function rr(e){const t=ir(e),n=t.indexOf("!");return-1===n?t:t.slice(0,n)
}class sr{constructor(e,t,n){this._element=e,this._onFrameAdded=t,this._onFrameRemoved=n,this._annotatableFrames=new Set,this._isDisconnected=!1,this._mutationObserver=new MutationObserver(Ei((()=>{this._discoverFrames()}),40)),this._discoverFrames(),this._mutationObserver.observe(this._element,{childList:!0,subtree:!0,attributeFilter:["enable-annotation"]})}disconnect(){this._isDisconnected=!0,this._mutationObserver.disconnect()}async _addFrame(e){this._annotatableFrames.add(e);try{if(await ar(e),this._isDisconnected)return;e.contentWindow.addEventListener("unload",(()=>{this._removeFrame(e)})),this._onFrameAdded(e)}catch{console.warn(`Unable to inject the Hypothesis client (from '${document.location.href}' into a cross-origin frame '${e.src}')`)}}_removeFrame(e){this._annotatableFrames.delete(e),this._onFrameRemoved(e)}_discoverFrames(){const e=new Set(this._element.querySelectorAll("iframe[enable-annotation]"));for(const t of e)this._annotatableFrames.has(t)||this._addFrame(t)
;for(const t of this._annotatableFrames)e.has(t)||this._removeFrame(t)}}function ar(e){return new Promise(((t,n)=>{const o=lr(e,((e,i)=>{o(),i?t(i):n(e)}))}))}function lr(e,t,{pollInterval:n=10}={}){let o,i;const r=new WeakSet,s=()=>{clearTimeout(o),o=void 0},a=()=>{const n=e.contentDocument;if(n){if(!r.has(n)){if(r.add(n),s(),!function(e){return"about:blank"===e.contentDocument?.location.href&&e.hasAttribute("src")&&"about:blank"!==e.src}(e)){"interactive"===n.readyState||"complete"===n.readyState?t(null,n):n.addEventListener("DOMContentLoaded",(()=>t(null,n)))}e.contentDocument&&e.contentWindow?.addEventListener("unload",i)}}else{s();const n=e.isConnected?"Frame is cross-origin":"Frame is disconnected";t(new Error(n))}};let l=!1;i=()=>{s(),l||(o=setInterval(a,n))},e.addEventListener("load",a);const c=setTimeout(a,0);return()=>{l=!0,clearTimeout(c),s(),e.removeEventListener("load",a)}}class cr{constructor(e,t){this._config=t,this._frameObserver=new sr(e,(e=>dr(e,t)),(()=>{}))}destroy(){
this._frameObserver.disconnect()}}async function dr(e,t,n){if(null!==e.contentDocument.querySelector("script.js-hypothesis-config"))return;await ar(e);const{assetRoot:o,notebookAppUrl:i,profileAppUrl:r,sidebarAppUrl:s}=vn(document),a={...t,assetRoot:o,notebookAppUrl:i,profileAppUrl:r,sidebarAppUrl:s,subFrameIdentifier:n??en(10)},l=document.createElement("script");l.className="js-hypothesis-config",l.setAttribute("data-remove-on-unload",""),l.type="application/json",l.innerText=JSON.stringify(a);const c=document.createElement("script");c.async=!0,c.src=t.clientUrl;const d=e.contentDocument;d.body.appendChild(l),d.body.appendChild(c)}class ur{constructor(e,t,n){if(t.length!==n.length)throw new Error("Char boxes length does not match text length");const o=e.parentNode,i=document.createElement("hypothesis-text-layer");o.insertBefore(i,e.nextSibling),o.style.position="relative",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.color="transparent",i.style.textAlign="left",
i.style.mixBlendMode="multiply";const r="sans-serif";i.style.fontSize="16px",i.style.fontFamily=r;const s=document.createElement("canvas").getContext("2d");s.font=`16px ${r}`;const a=(e,t,n="px")=>`calc(var(--${e}-scale) * ${t}${n})`,l=function(e,t){const n=[];let o={text:"",rect:new DOMRect};const i=()=>{o.text.length>0&&(n.push(o),o={text:"",rect:new DOMRect})};for(const[n,r]of e.entries()){const e=t[n],s=/\s/.test(e);o.text.length>0&&!Sn(o.rect,r)&&i(),o.rect=kn(o.rect,r),o.text+=s?" ":e,s&&i()}i();const r=[];let s={words:[],rect:new DOMRect};const a=()=>{s.words.length>0&&(r.push(s),s={words:[],rect:new DOMRect})};for(const e of n){const t=s.words[s.words.length-1];if(t){const n=An(t.rect),o=An(e.rect).x-n.x;(!Sn(t.rect,e.rect)||o<0)&&a()}s.words.push(e),s.rect=kn(s.rect,e.rect)}a();const l=[];let c={lines:[],rect:new DOMRect};const d=()=>{c.lines.length>0&&(l.push(c),c={lines:[],rect:new DOMRect})};for(const e of r){const t=c.lines[c.lines.length-1];if(t){const n=An(t.rect),o=An(e.rect).y-n.y
;(!En(t.rect,e.rect)||Sn(t.rect,e.rect)||o<0||o>4*e.rect.height)&&d()}c.lines.push(e),c.rect=kn(c.rect,e.rect)}return d(),l}(t,n);for(const e of l){const t=document.createElement("hypothesis-text-column");t.style.display="block",t.style.position="absolute",t.style.left=a("x",e.rect.left),t.style.top=a("y",e.rect.top);let n=null;for(const o of e.lines){const i=document.createElement("hypothesis-text-line");i.style.display="block",i.style.marginLeft=a("x",o.rect.left-e.rect.left),i.style.height=a("y",o.rect.height),n&&(i.style.marginTop=a("y",o.rect.top-n.rect.bottom)),n=o,i.style.whiteSpace="nowrap";let r=null;for(const e of o.words){const t=document.createElement("hypothesis-text-word");t.style.display="inline-block",t.style.transformOrigin="top left",t.textContent=e.text,r&&(t.style.marginLeft=a("x",e.rect.left-r.rect.right)),r=e,t.style.width=a("x",e.rect.width),t.style.height=a("y",e.rect.height),t.style.whiteSpace="pre"
;const n=s.measureText(e.text),o=a("x",e.rect.width/n.width,""),l=a("y",e.rect.height/16,"");t.style.transform=`scale(${o}, ${l})`,i.append(t)}t.append(i)}i.append(t)}const c=()=>{const{width:t,height:n}=e.getBoundingClientRect();i.style.width=t+"px",i.style.height=n+"px",i.style.setProperty("--x-scale",`${t}`),i.style.setProperty("--y-scale",`${n}`)};c(),this.container=i,this._updateTextLayerSize=Ei(c,{maxWait:50}),this._listeners=new be,"undefined"!=typeof ResizeObserver&&(this._imageSizeObserver=new ResizeObserver((()=>{this._updateTextLayerSize()})),this._imageSizeObserver.observe(e)),this._listeners.add(window,"resize",this._updateTextLayerSize)}updateSync(){this._updateTextLayerSize(),this._updateTextLayerSize.flush()}destroy(){this.container.remove(),this._listeners.removeAll(),this._updateTextLayerSize.cancel(),this._imageSizeObserver?.disconnect()}}function hr(e=document){return e.querySelector("mosaic-book")}function fr(e=window){if(hr(e.document))return"container"
;const t=e.frameElement?.ownerDocument;return t&&hr(t)?"content":null}class mr{constructor(e){const t=hr();if(!t)throw new Error("Book container element not found");const n=new WeakSet,o=t.shadowRoot,i=()=>{const t=o.querySelector("iframe");t&&!n.has(t)&&(n.add(t),lr(t,((n,o)=>{if(n)return;const i=o.body;i&&!i.querySelector("#page-content")&&dr(t,e,"vitalsource-content")})))};i(),this._frameObserver=new MutationObserver(i),this._frameObserver.observe(o,{childList:!0,subtree:!0})}destroy(){this._frameObserver.disconnect()}}function gr(){return document.querySelector("img#pbk-page")}class pr extends an.TinyEmitter{constructor(e=document.body,t={}){super();const n=t.bookElement??hr(window.parent.document);if(!n)throw new Error("Failed to find <mosaic-book> element in container frame");this._bookElement=n;const o=new Ho;this._htmlIntegration=new xi({container:e,features:o}),this._listeners=new be;const i=["mouseup","mousedown","mouseout"];for(const e of i)this._listeners.add(document.documentElement,e,(e=>{
e.stopPropagation()}));const r=window.frameElement;r&&function(e){if("no"!==e.getAttribute("scrolling"))return;const t=document.createElement("style");t.textContent="iframe { height: 100% !important; }",e.insertAdjacentElement("beforebegin",t);const n=()=>e.removeAttribute("scrolling");n(),new MutationObserver(n).observe(e,{attributes:!0})}(r);const s=gr(),a=window.innerPageData;if(s&&a){const e=a.glyphs.glyphs.map((e=>{const t=e.l/100,n=e.r/100,o=e.t/100,i=e.b/100;return new DOMRect(t,o,n-t,i-o)}));this._textLayer=new ur(s,e,a.words),this._textLayer.container.style.zIndex="100",this._sideBySideActive=!1}}getAnnotatableRange(e){return this._htmlIntegration.getAnnotatableRange(e)}destroy(){this._textLayer&&(this._textLayer.destroy(),this.fitSideBySide({expanded:!1,height:window.innerHeight,width:0,toolbarWidth:0})),this._listeners.removeAll(),this._htmlIntegration.destroy()}anchor(e,t){return this._htmlIntegration.anchor(e,t)}async describe(e,t){
const n=this._htmlIntegration.describe(e,t),{cfi:o,index:i,page:r,title:s,url:a}=await this._getPageInfo({includeTitle:!0,includePageIndex:!0}),l=[{type:"EPUBContentSelector",cfi:o,url:a,title:s}];if("number"==typeof i){const e={type:"PageSelector",index:i,label:r};l.push(e)}return n.push(...l),n}contentContainer(){return this._htmlIntegration.contentContainer()}fitSideBySide(e){const t=gr();if(t&&this._textLayer){const n=t.parentElement,o=this._textLayer,i=window.innerWidth-e.width;return this._sideBySideActive=!1,Fn((()=>{e.expanded&&i>480?(n.style.textAlign="left",t.style.width=`${i}px`,this._sideBySideActive=!0):(n.style.textAlign="",t.style.width=""),o.updateSync()})),this._sideBySideActive}return this._htmlIntegration.fitSideBySide(e)}sideBySideActive(){return"boolean"==typeof this._sideBySideActive?this._sideBySideActive:this._htmlIntegration.sideBySideActive()}async getMetadata(){return{title:this._bookElement.getBookInfo().title,link:[]}}navigateToSegment(e){
const t=e.target[0].selector?.find((e=>"EPUBContentSelector"===e.type));if(t?.cfi)this._bookElement.goToCfi(t.cfi);else{if(!t?.url)throw new Error("No segment information available");this._bookElement.goToURL(function(e){const t=new URL(e,document.baseURI);return t.pathname+t.search}(t.url))}}persistFrame(){return!0}async _getPageInfo({includeTitle:e=!1,includePageIndex:t=!1}={}){const[n,o,i]=await Promise.all([this._bookElement.getCurrentPage(),e?this._bookElement.getTOC():void 0,t?this._bookElement.getPages():void 0]),r=["absoluteURL","cfi"];for(const e of r)if(!(e in n))throw new Error(`Page metadata field "${e}" is missing`);let s;if(o){s=n.chapterTitle;const e=rr(n.cfi),t=o.data?.find((t=>rr(t.cfi)===e));t&&(s=t.title)}let a=n.index;if(void 0===a&&i){const e=i.data?.findIndex((e=>e.cfi===n.cfi));-1!==e&&(a=e)}return{cfi:n.cfi,index:a,page:n.page,title:s,url:new URL(n.absoluteURL,document.baseURI).toString()}}async _getPageRange(e){let t=[];try{const e=await this._bookElement.getPageBreaks()
;e.ok&&e.data&&(t=e.data)}catch(e){console.error("Failed to get page breaks",e)}const n=ir(e),o=t.filter((e=>e.cfiWithoutAssertions.split("!")[0]===n));let i;if(o.length>0){i={start:o[0].label,end:o[o.length-1].label}}return i}async segmentInfo(){const{cfi:e,url:t}=await this._getPageInfo();return{cfi:e,pages:await this._getPageRange(e),url:t}}async uri(){const e=this._bookElement.getBookInfo().isbn;if(!e)throw new Error("Unable to get book ID from VitalSource");return`https://bookshelf.vitalsource.com/reader/books/${e}`}async scrollToAnchor(e){return this._htmlIntegration.scrollToAnchor(e)}}function _r(e){if(void 0!==window.PDFViewerApplication)return new or(e);return"content"===fr()?new pr(document.body):new xi({features:e.features,sideBySideOptions:e.sideBySide})}function br(){return Pe(Wt,{classes:"fixed left-[10px] top-[10px]","data-testid":"outside-assignment-notice",status:"notice",variant:"raised",children:"You are outside the page range for this assignment. Annotations made here may not be counted."
})}class wr{constructor(e){this._visible=!1,this._container=new eo("notice",(()=>this._render())),e.appendChild(this._container.element)}destroy(){this._container.destroy()}setVisible(e){this._visible=e,this._container.render()}_render(){return this._visible?Pe(br,{}):null}}class vr{constructor(e,t=document){let n=!1;this._pendingCallback=null;const o=(n=10)=>{this._pendingCallback=setTimeout((()=>{e(_o(t.getSelection()))}),n)},i=e=>{if("mousedown"===e.type&&(n=!0),"mouseup"===e.type&&(n=!1),n)return;this._cancelPendingCallback();const t="mouseup"===e.type?10:100;o(t)};this._document=t,this._listeners=new be,this._listeners.add(t,"selectionchange",i),this._listeners.add(t.body,"mousedown",i),this._listeners.add(t.body,"mouseup",i),o(1)}disconnect(){this._listeners.removeAll(),this._cancelPendingCallback()}_cancelPendingCallback(){this._pendingCallback&&(clearTimeout(this._pendingCallback),this._pendingCallback=null)}}function yr(e,t){if(e===t)return!0;if(e.parent!==t)return!1;if(!e.frameElement)return!1
;return e.frameElement.getBoundingClientRect().width/e.parent.innerWidth>=.8}function xr(){return function(e,t){const n=new Set,o=new Set;return vo(e,(e=>{for(;e&&!n.has(e);){n.add(e);const i=t(e);null!=i&&o.add(i),e=e.parentNode}})),[...o]}(_o()??new Range,(e=>e._annotation?.$tag))}function Nr(e){const t=function(e){let t=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;const n=[];for(;t;)t.classList.contains("hypothesis-highlight")&&n.push(t),t=t.parentElement;return n}(e).map((e=>e._annotation)).filter((e=>void 0!==e)).map((e=>e?.$tag));return t}function Cr(e){if(!e.range)return null;try{return e.range.toRange()}catch{return null}}function Sr(){document.getSelection()?.removeAllRanges()}class Er extends CustomEvent{constructor(e){super("scrolltorange",{bubbles:!0,cancelable:!0,detail:e}),this._ready=null}get ready(){return this._ready}waitUntil(e){this._ready=e}}class kr extends an.TinyEmitter{constructor(e,t={},n=window){super(),this.element=e,this._contentReady=t.contentReady,this._hostFrame=n,
this._highlightsVisible=!1,this._isAdderVisible=!1,this._informHostOnNextSelectionClear=!0,this.selectedRanges=[],this._outsideAssignmentNotice=null,this._adder=new oo(this.element,{onAnnotate:()=>this.createAnnotation(),onHighlight:()=>this.createAnnotation({highlight:!0}),onShowAnnotations:e=>this.selectAnnotations(e,{focusInSidebar:!0})}),this._selectionObserver=new vr((e=>{e?this._onSelection(e):this._onClearSelection()})),this.anchors=[],this._annotations=new Set,this._frameIdentifier=t.subFrameIdentifier||null,this._portFinder=new on({hostFrame:this._hostFrame,source:"guest",sourceId:this._frameIdentifier??void 0}),this.features=new Ho,this._featureFlagsReceived=new Promise((e=>{this.features.on("flagsChanged",e)})),this.sideBySide=t.sideBySide,this._integration=_r(this),this._integration.on("uriChanged",(()=>this._sendDocumentInfo())),t.contentInfoBanner&&this._integration.showContentInfo?.(t.contentInfoBanner),
this._integration.canStyleClusteredHighlights?.()&&(this._clusterToolbar=new Wo(this._integration.contentContainer(),{features:this.features})),this._hostRPC=new bn,this._connectHost(n),this._sidebarRPC=new bn,this._sidebarLayout=null,this._connectSidebar(),this._bucketBarClient=new Mo({contentContainer:this._integration.contentContainer(),hostRPC:this._hostRPC}),this._listeners=new be,this._setupElementEvents(),this._hoveredAnnotations=new Set}_sideBySideActive(){return"manual"===this.sideBySide?.mode&&this.sideBySide.isActive?this.sideBySide.isActive():this._integration.sideBySideActive()}_setupElementEvents(){this._listeners.add(this.element,"mouseup",(e=>{const{target:t,metaKey:n,ctrlKey:o}=e,i=Nr(t);if(i.length&&this._highlightsVisible){const e=n||o;this.selectAnnotations(i,{toggle:e})}})),this._listeners.add(this.element,"pointerdown",(e=>{
this._sideBySideActive()||e.composedPath().some((e=>e instanceof Element&&e.localName.startsWith("hypothesis-")))||Nr(e.target).length||yr(window,this._hostFrame)&&this._sidebarLayout?.expanded&&window.innerWidth-e.clientX<this._sidebarLayout.width||this._sidebarRPC.call("closeSidebar")})),this._listeners.add(this.element,"mouseover",(({target:e})=>{const t=Nr(e);t.length&&this._highlightsVisible&&this._sidebarRPC.call("hoverAnnotations",t)})),this._listeners.add(this.element,"mouseout",(()=>{this._highlightsVisible&&this._sidebarRPC.call("hoverAnnotations",[])})),this._listeners.add(this.element,"keydown",(e=>{this._handleShortcut(e)})),this._listeners.add(window,"resize",(()=>this._repositionAdder()))}async getDocumentInfo(){const[e,t,n]=await Promise.all([this._integration.uri(),this._integration.getMetadata(),this._integration.segmentInfo?.()]);return{uri:vi(e),metadata:t,segmentInfo:n,persistent:this._integration.persistFrame?.()??!1}}async _sendDocumentInfo(){
this._integration.waitForFeatureFlags?.()&&await this._featureFlagsReceived;const e=await this.getDocumentInfo();this._sidebarRPC.call("documentInfoChanged",e)}_repositionAdder(){if(!this._isAdderVisible)return;const e=_o();e&&this._onSelection(e)}async _connectHost(e){this._hostRPC.on("clearSelection",(()=>{_o()&&(this._informHostOnNextSelectionClear=!1,Sr())})),this._hostRPC.on("createAnnotation",(()=>this.createAnnotation())),this._hostRPC.on("hoverAnnotations",(e=>this._hoverAnnotations(e))),this._hostRPC.on("scrollToAnnotation",(e=>{this._scrollToAnnotation(e)})),this._hostRPC.on("selectAnnotations",((e,t)=>this.selectAnnotations(e,{toggle:t}))),this._hostRPC.on("sidebarLayoutChanged",(t=>{yr(window,e)&&this.fitSideBySide(t),this.element.dispatchEvent(new Io({sidebarLayout:t,sideBySideActive:this._sideBySideActive()}))})),this._hostRPC.on("close",(()=>this.emit("hostDisconnected")));const t=await this._portFinder.discover("host");this._hostRPC.connect(t)}async _scrollToAnchor(e){const t=Cr(e)
;if(!t)return;const n=new Er(t);this.element.dispatchEvent(n)&&(await n.ready,await this._integration.scrollToAnchor(e))}async _scrollToAnnotation(e){const t=this.anchors.find((t=>t.annotation.$tag===e));t?.highlights&&await this._scrollToAnchor(t)}async _connectSidebar(){this._sidebarRPC.on("featureFlagsUpdated",(e=>this.features.update(e))),this._sidebarRPC.on("hoverAnnotations",(e=>this._hoverAnnotations(e))),this._sidebarRPC.on("scrollToAnnotation",(e=>{this._scrollToAnnotation(e)})),this._sidebarRPC.on("setHighlightsVisible",(e=>{this.setHighlightsVisible(e,!1)})),this._sidebarRPC.on("deleteAnnotation",(e=>this.detach(e))),this._sidebarRPC.on("loadAnnotations",(async e=>{try{await Promise.all(e.map((e=>this.anchor(e))))}catch(e){console.warn("Failed to anchor annotations:",e)}})),this._sidebarRPC.on("showContentInfo",(e=>this._integration.showContentInfo?.(e))),this._sidebarRPC.on("setOutsideAssignmentNoticeVisible",(e=>{this._setOutsideAssignmentNoticeVisible(e)})),
this._sidebarRPC.on("navigateToSegment",(e=>this._integration.navigateToSegment?.(e))),this._portFinder.discover("sidebar").then((e=>{this._sidebarRPC.connect(e)})),this._sendDocumentInfo()}destroy(){var e;this._portFinder.destroy(),this._hostRPC.destroy(),this._sidebarRPC.destroy(),this._listeners.removeAll(),this._selectionObserver.disconnect(),this._adder.destroy(),this._bucketBarClient.destroy(),this._clusterToolbar?.destroy(),this._outsideAssignmentNotice?.destroy(),e=this.element,Eo(Array.from(e.querySelectorAll("hypothesis-highlight"))),this._integration.destroy()}async anchor(e){this._contentReady&&(await this._contentReady,this._contentReady=void 0);const t=e=>{const t=Cr(e);if(!t)return;const n=Co(t,e.annotation?.$cluster);n.forEach((t=>{t._annotation=e.annotation})),e.highlights=n,this._hoveredAnnotations.has(e.annotation.$tag)&&ko(n,!0)};this.detach(e.$tag,!1),this._annotations.add(e.$tag),e.target||(e.target=[]);const n=await Promise.all(e.target.map((async t=>{
if(!t.selector||!t.selector.some((e=>"TextQuoteSelector"===e.type)))return{annotation:e,target:t};let n;try{const o=await this._integration.anchor(this.element,t.selector),i=fo.fromRange(o);n={annotation:e,target:t,range:i}}catch{n={annotation:e,target:t}}return n})));if(!this._annotations.has(e.$tag))return[];for(const e of n)t(e);return e.$orphan=n.length>0&&n.every((e=>e.target.selector&&!e.range)),this._updateAnchors(this.anchors.concat(n),!0),this._sidebarRPC.call("syncAnchoringStatus",e),n}detach(e,t=!0){this._annotations.delete(e);const n=[];for(const t of this.anchors)t.annotation.$tag!==e?n.push(t):t.highlights&&Eo(t.highlights);this._updateAnchors(n,t)}_updateAnchors(e,t){this.anchors=e,this._clusterToolbar?.scheduleClusterUpdates(),t&&this._bucketBarClient.update(this.anchors)}async createAnnotation({highlight:e=!1}={}){const t=this.selectedRanges;this.selectedRanges=[];const n=await this.getDocumentInfo(),o=this.element,i=(await Promise.all(t.map((e=>this._integration.describe(o,e))))).map((e=>({
source:n.uri,selector:e}))),r={uri:n.uri,document:n.metadata,target:i,$highlight:e,$cluster:e?"user-highlights":"user-annotations",$tag:"a:"+en(8)};return this._sidebarRPC.call("createAnnotation",r),this.anchor(r),Sr(),r}_hoverAnnotations(e){this._hoveredAnnotations.clear(),e.forEach((e=>this._hoveredAnnotations.add(e)));for(const t of this.anchors)if(t.highlights){const n=e.includes(t.annotation.$tag);ko(t.highlights,n)}this._sidebarRPC.call("hoverAnnotations",e)}_onSelection(e){const t=this._integration.getAnnotatableRange(e);if(!t)return void this._onClearSelection();const n=document.getSelection(),o=bo(n),i=yo(n);i?(this.selectedRanges=[t],this._hostRPC.call("textSelected"),this._adder.annotationsForSelection=xr(),this._isAdderVisible=!0,this._adder.show(i,o)):this._onClearSelection()}_onClearSelection(){this._isAdderVisible=!1,this._adder.hide(),this.selectedRanges=[],this._informHostOnNextSelectionClear&&this._hostRPC.call("textUnselected"),this._informHostOnNextSelectionClear=!0}
selectAnnotations(e,{toggle:t=!1,focusInSidebar:n=!1}={}){t?this._sidebarRPC.call("toggleAnnotationSelection",e):this._sidebarRPC.call("showAnnotations",e,n),this._sidebarRPC.call("openSidebar")}setHighlightsVisible(e,t=!0){!function(e,t){e.classList.toggle("hypothesis-highlights-always-on",t)}(this.element,e),this._highlightsVisible=e,t&&this._hostRPC.call("highlightsVisibleChanged",e)}get highlightsVisible(){return this._highlightsVisible}fitSideBySide(e){this._sidebarLayout=e,this._integration.fitSideBySide(e)}get hoveredAnnotationTags(){return this._hoveredAnnotations}_handleShortcut(e){zn(e,"Ctrl+Shift+H")&&this.setHighlightsVisible(!this._highlightsVisible)}_setOutsideAssignmentNoticeVisible(e){this._outsideAssignmentNotice||(this._outsideAssignmentNotice=new wr(this.element)),this._outsideAssignmentNotice.setVisible(e)}}function Ar(e,t){const n=new URL(e),o=new URLSearchParams;return o.append("config",JSON.stringify(t)),n.hash=o.toString(),n.toString()}function Rr(e,t){const n={}
;for(const[e,o]of Object.entries(t))"notebookAppUrl"!==e&&"sidebarAppUrl"!==e&&null!=o&&(n[e]=o);n.origin=new URL(e).origin,n.version="1.1559.0";const o=new URL(window.location.href);if(o.hash="",n.hostURL=o.toString(),Array.isArray(n.services)&&n.services?.length>0){const e=n.services[0];e.onLoginRequest&&(e.onLoginRequestProvided=!0),e.onLogoutRequest&&(e.onLogoutRequestProvided=!0),e.onSignupRequest&&(e.onSignupRequestProvided=!0),e.onProfileRequest&&(e.onProfileRequestProvided=!0),e.onHelpRequest&&(e.onHelpRequestProvided=!0)}return n}function Pr({closed:e,onClose:t,children:n,"data-testid":o,"aria-label":i}){const r=re(null);return oe((()=>{e?r.current?.close():r.current?.showModal()}),[e]),oe((()=>{const e=r.current;return e?.addEventListener("cancel",t),()=>{e?.removeEventListener("cancel",t)}}),[t]),Pe("dialog",{ref:r,className:"relative w-full h-full backdrop:bg-black/50","data-testid":o,"aria-label":i,children:n})}function Tr({closed:e,children:t,...n}){return Pe("div",{...n,
className:Ae("fixed z-max top-0 left-0 right-0 bottom-0 p-3 bg-black/50",{hidden:e}),children:Pe("div",{className:"relative w-full h-full",children:t})})}function Or({document_:e=document,...t}){return Pe(se((()=>function(e){return"function"==typeof e.createElement("dialog").showModal}(e)?Pr:Tr),[e]),{...t})}function Lr({config:e,groupId:t}){return Pe("iframe",{title:"Hypothesis annotation notebook",className:"h-full w-full border-0",allow:"fullscreen; clipboard-write",src:Ar(e.notebookAppUrl,{...Rr(e.notebookAppUrl,e),group:t})})}function Mr({eventBus:e,config:t}){const[n,o]=ne(0),[i,r]=ne(!0),[s,a]=ne(null),l=re(""),c=re(null);oe((()=>(l.current=document.body.style.overflow,()=>{document.body.style.overflow=l.current})),[]),oe((()=>{document.body.style.overflow=i?l.current:"hidden"}),[i]),oe((()=>{const t=e.createEmitter();return t.subscribe("openNotebook",(e=>{r(!1),o((e=>e+1)),a(e)})),c.current=t,()=>{t.destroy()}}),[e]);const d=ae((()=>{r(!0),c.current?.publish("closeNotebook")}),[])
;return null===s?null:Pe(Or,{closed:i,onClose:d,"data-testid":"notebook-outer","aria-label":"Hypothesis notebook",children:[Pe("div",{className:"absolute right-0 m-3",children:Pe(St,{title:"Close notebook",onClick:d,variant:"dark",classes:Ae("!bg-transparent enabled:hover:!bg-grey-3"),"data-testid":"close-button",children:Pe(De,{className:"w-4 h-4"})})}),Pe(Lr,{config:t,groupId:s},n)]})}class Ir{constructor(e,t,n){this._container=new eo("notebook",(()=>Pe(Mr,{eventBus:t,config:n}))),e.append(this._container.element),this._container.render()}destroy(){this._container.destroy()}}function Br({eventBus:e,config:t}){const[n,o]=ne(!0),i=re(null);oe((()=>{const t=e.createEmitter();return t.subscribe("openProfile",(()=>{o(!1)})),i.current=t,()=>{t.destroy()}}),[e]);const r=()=>{o(!0),i.current?.publish("closeProfile")};return n?null:Pe(Or,{closed:n,onClose:r,"data-testid":"profile-outer","aria-label":"Hypothesis profile",children:[Pe("div",{className:"absolute right-0 m-3",children:Pe(St,{
title:"Close profile dialog",onClick:r,variant:"dark",classes:Ae("!bg-transparent enabled:hover:!bg-grey-3"),children:Pe(De,{className:"w-4 h-4"})})}),Pe("iframe",{title:"Hypothesis profile",className:"h-full w-full border-0",src:t.profileAppUrl})]})}class Fr{constructor(e,t,n){this._container=new eo("profile",(()=>Pe(Br,{eventBus:t,config:n}))),e.append(this._container.element),this._container.render()}destroy(){this._container.destroy()}}function Dr({above:e,below:t,buckets:n,onFocusAnnotations:o,onScrollToAnnotation:i,onSelectAnnotations:r}){const s=e.anchors.length>0,a=t.anchors.length>0,l=e=>e.anchors.map((e=>e.tag));return Pe("ul",{className:"relative",children:[s&&Pe("li",{className:"absolute right-0 pointer-events-auto mt-[-11px]",style:{top:e.position},children:Pe(Jt,{"data-testid":"up-navigation-button",direction:"up",onClick:()=>{const t=[...e.anchors].sort(((e,t)=>e.bottom-t.bottom)),n=t[t.length-1];i(n.tag)},onBlur:()=>o([]),onFocus:()=>o(l(e)),onMouseEnter:()=>o(l(e)),onMouseOut:()=>o([]),
title:`Go up to next annotations (${e.anchors.length})`,children:e.anchors.length})}),n.map(((e,t)=>Pe("li",{className:"absolute right-0 pointer-events-auto mt-[-8px]",style:{top:e.position},children:Pe(Jt,{direction:"left",onClick:t=>r(l(e),t.metaKey||t.ctrlKey),onBlur:()=>o([]),onFocus:()=>o(l(e)),onMouseEnter:()=>o(l(e)),onMouseOut:()=>o([]),title:`Select nearby annotations (${e.anchors.length})`,children:e.anchors.length})},t))),a&&Pe("li",{className:"absolute right-0 pointer-events-auto",style:{top:t.position},children:Pe(Jt,{"data-testid":"down-navigation-button",direction:"down",onClick:()=>{const e=[...t.anchors].sort(((e,t)=>e.top-t.top)),n=e[0];i(n.tag)},onBlur:()=>o([]),onFocus:()=>o(l(t)),onMouseEnter:()=>o(l(t)),onMouseOut:()=>o([]),title:`Go up to next annotations (${t.anchors.length})`,children:t.anchors.length})})]})}class Hr{constructor(e,{onFocusAnnotations:t,onScrollToAnnotation:n,onSelectAnnotations:o}){this._positions=[],this._container=new eo("bucket-bar",(()=>this._render())),
Object.assign(this._container.element.style,{display:"block",flexGrow:"1",width:"100%"}),e.appendChild(this._container.element),this._onFocusAnnotations=t,this._onScrollToAnnotation=n,this._onSelectAnnotations=o,this._container.render()}destroy(){this._container.destroy()}update(e){this._positions=e,this._container.render()}_render(){const e=function(e,t){const n=[],o=[],i=[];let r=null;function s(e){const{bottom:t,top:n}=e;return{bottom:t,position:n+(t-n)/2,anchors:[e],top:n}}const a=t.getBoundingClientRect(),l=e.map((e=>({tag:e.tag,top:e.top-a.top,bottom:e.bottom-a.top})));for(const e of l){const t=(e.top+e.bottom)/2;if(t<30){n.push(e);continue}if(t>a.height-30){o.push(e);continue}if(!r){r=s(e);continue}const l=e.top>r.top&&e.bottom<r.bottom;if(e.top-r.bottom>60&&!l)i.push(r),r=s(e);else{const t=e.bottom>r.bottom?e.bottom:r.bottom,n=t-r.top;r.anchors.push(e),r.bottom=t,r.position=r.top+n/2}}return r&&i.push(r),{above:{anchors:n,position:30},below:{anchors:o,position:a.height-30},buckets:i}
}(this._positions,this._container.element);return Pe(Dr,{above:e.above,below:e.below,buckets:e.buckets,onFocusAnnotations:e=>this._onFocusAnnotations(e),onScrollToAnnotation:e=>this._onScrollToAnnotation(e),onSelectAnnotations:(e,t)=>this._onSelectAnnotations(e,t)})}}function Vr({emitter:e}){const[t,n]=ne([]),o=ae((e=>n((t=>[...t,e]))),[]),i=ae((e=>n((t=>t.filter((t=>t.id!==e))))),[]);return oe((()=>(e.subscribe("toastMessageAdded",o),e.subscribe("toastMessageDismissed",i),()=>{e.unsubscribe("toastMessageAdded",o),e.unsubscribe("toastMessageDismissed",i)})),[e,i,o]),Pe(Kt,{messages:t,onMessageDismiss:i})}function Ur({icon:e,...t}){return Pe(xt,{classes:Ae("justify-center rounded","w-[30px] h-[30px]","shadow border bg-white text-grey-6 hover:text-grey-9"),...t,size:"custom",variant:"custom",children:Pe(e,{})})}function qr({highlightsVisible:e}){return Pe("div",{className:"sr-only",role:"status","data-testid":"toolbar-status",children:e?"Highlights visible":"Highlights hidden"})}
function $r({closeSidebar:e,createAnnotation:t,isSidebarOpen:n,sidebarContainerId:o,newAnnotationType:i,showHighlights:r,toggleHighlights:s,toggleSidebar:a,toggleSidebarRef:l,useMinimalControls:c=!1}){return Pe("div",{className:Ae("absolute left-[-33px] w-[33px] z-2","text-px-base leading-none"),children:[c&&n&&Pe(xt,{classes:Ae("transition-colors focus-visible-ring ring-inset","w-[27px] h-[27px] mt-[140px] ml-px-1.5","flex items-center justify-center bg-white border","text-grey-6 hover:text-grey-9 transition-colors","border-r-0","shadow-sidebar"),title:"Close annotation sidebar",onClick:e,unstyled:!0,children:Pe(De,{})}),!c&&Pe(x,{children:[Pe(xt,{classes:Ae("transition-colors focus-visible-ring ring-inset","h-[40px] w-[33px] pl-[6px] rounded-bl","bg-white text-grey-5 hover:text-grey-9","border-l border-b"),elementRef:l,title:"Annotation sidebar",expanded:n,"aria-controls":o,onClick:a,unstyled:!0,children:Pe(n?We:qe,{})}),Pe("div",{className:"space-y-px-1.5 mt-px-2",children:[Pe(Ur,{title:"Show highlights",
icon:r?vt:nt,pressed:r,onClick:s}),Pe(Ur,{title:"note"===i?"New page note":"New annotation",icon:"note"===i?dt:Be,onClick:t})]}),Pe(qr,{highlightsVisible:r})]})]})}class Wr{constructor(e,t){const{createAnnotation:n,setSidebarOpen:o,setHighlightsVisible:i}=t;this._container=e,this._useMinimalControls=!1,this._newAnnotationType="note",this._highlightsVisible=!1,this._sidebarOpen=!1,this._sidebarContainerId=t.sidebarContainerId,this._closeSidebar=()=>o(!1),this._toggleSidebar=()=>o(!this._sidebarOpen),this._toggleHighlights=()=>i(!this._highlightsVisible),this._createAnnotation=()=>{n(),o(!0)},this._sidebarToggleButton={current:null},this.render()}getWidth(){return this._container.firstChild.getBoundingClientRect().width}set useMinimalControls(e){this._useMinimalControls=e,this.render()}get useMinimalControls(){return this._useMinimalControls}set sidebarOpen(e){this._sidebarOpen=e,this.render()}get sidebarOpen(){return this._sidebarOpen}set newAnnotationType(e){this._newAnnotationType=e,this.render()}
get newAnnotationType(){return this._newAnnotationType}set highlightsVisible(e){this._highlightsVisible=e,this.render()}get highlightsVisible(){return this._highlightsVisible}get sidebarToggleButton(){return this._sidebarToggleButton.current}render(){V(Pe($r,{closeSidebar:this._closeSidebar,createAnnotation:this._createAnnotation,newAnnotationType:this._newAnnotationType,isSidebarOpen:this._sidebarOpen,sidebarContainerId:this._sidebarContainerId,showHighlights:this._highlightsVisible,toggleHighlights:this._toggleHighlights,toggleSidebar:this._toggleSidebar,toggleSidebarRef:this._sidebarToggleButton,useMinimalControls:this.useMinimalControls}),this._container)}}class zr{constructor({target:e,threshold:t=10,onDrag:n}){e.style.touchAction="none",this._listeners=new be,this._startX=null,this._dragActive=!1,this._threshold=t,this._listeners.add(e,"pointerdown",(e=>{this._startX=e.clientX}));const o=e=>{if(null!==this._startX&&this._dragActive){const t=e.clientX-this._startX;n({type:"dragend",deltaX:t})}
this._startX=null,this._dragActive=!1};this._listeners.add(window,"pointercancel",o),this._listeners.add(window,"pointerup",o),this._listeners.add(window,"pointermove",(e=>{if(null===this._startX)return;const t=e.clientX-this._startX;!this._dragActive&&Math.abs(t)>=this._threshold&&(this._dragActive=!0,n({type:"dragstart",deltaX:t})),this._dragActive&&n({type:"dragmove",deltaX:t})}))}destroy(){this._listeners.removeAll()}}class jr{constructor(e,t,n){if(this._emitter=t.createEmitter(),this._guestWithSelection=null,this._guestRPC=[],this._sidebarRPC=new bn,this.iframe=function(e){const t=e.sidebarAppUrl,n=Ar(t,Rr(t,e)),o=document.createElement("iframe");return o.src=n,o.title="Hypothesis annotation viewer",o.className="sidebar-frame",o.allow="fullscreen; clipboard-write",o}(n),this._config=n,this.bucketBar=null,this.features=new Ho,n.externalContainerSelector)this.externalFrame=document.querySelector(n.externalContainerSelector)??e,this.externalFrame.appendChild(this.iframe);else{
if(this.iframeContainer=document.createElement("div"),this.iframeContainer.style.display="none",this.iframeContainer.className="sidebar-container",this.iframeContainer.id="sidebar-container","clean"===n.theme)this.iframeContainer.classList.add("theme-clean");else{let e;n.bucketContainerSelector&&(e=document.querySelector(n.bucketContainerSelector),e||console.warn(`Custom bucket container "${n.bucketContainerSelector}" not found`));const t=document.createElement("div");t.setAttribute("data-testid","sidebar-edge"),t.className=Ae("absolute top-0 bottom-0 w-[23px] left-[-22px]","flex flex-col pt-[110px] pr-[5px]","bg-grey-2 sidebar-collapsed:bg-black/[.08]","pointer-events-none"),this.iframeContainer.append(t),e||(e=t),this.bucketBar=new Hr(e,{onFocusAnnotations:e=>this._guestRPC.forEach((t=>t.call("hoverAnnotations",e))),onScrollToAnnotation:e=>this._guestRPC.forEach((t=>t.call("scrollToAnnotation",e))),onSelectAnnotations:(e,t)=>this._guestRPC.forEach((n=>n.call("selectAnnotations",e,t)))})}
this.iframeContainer.appendChild(this.iframe),this._hypothesisSidebar=document.createElement("hypothesis-sidebar");const t=Zn(this._hypothesisSidebar);t.appendChild(this.iframeContainer),e.appendChild(this._hypothesisSidebar),this._messagesElement=document.createElement("div"),t.appendChild(this._messagesElement),V(Pe(Vr,{emitter:this._emitter}),this._messagesElement)}this.iframe.contentWindow&&un(this.iframe.contentWindow),this._listeners=new be;const o=document.createElement("div");this.toolbar=new Wr(o,{sidebarContainerId:this.iframeContainer?.id,createAnnotation:()=>{if(0===this._guestRPC.length)return;(this._guestWithSelection??this._guestRPC[0]).call("createAnnotation")},setSidebarOpen:e=>e?this.open():this.close(),setHighlightsVisible:e=>this.setHighlightsVisible(e)}),"clean"===n.theme?this.toolbar.useMinimalControls=!0:this.toolbar.useMinimalControls=!1,this.iframeContainer?(this.iframeContainer.prepend(o),this._toolbarWidth=this.toolbar.getWidth()):this._toolbarWidth=0,
this._listeners.add(window,"resize",(()=>this._onResize())),this._dragResizeState={initial:null,final:null};const i=this.toolbar.sidebarToggleButton;i&&(this._dragResizeHandler=new zr({target:i,onDrag:e=>this._onDragSidebarToggleButton(e)})),this.close();const[r]=n.services||[];r&&(this.onLoginRequest=r.onLoginRequest,this.onLogoutRequest=r.onLogoutRequest,this.onSignupRequest=r.onSignupRequest,this.onProfileRequest=r.onProfileRequest,this.onHelpRequest=r.onHelpRequest),this.onLayoutChange=n.onLayoutChange,this._layoutState={expanded:!1,width:0,height:0,toolbarWidth:0},this._updateLayoutState(!1),this._setupSidebarEvents()}destroy(){this._guestRPC.forEach((e=>e.destroy())),this._sidebarRPC.destroy(),this.bucketBar?.destroy(),this._listeners.removeAll(),this._dragResizeHandler?.destroy(),this._hypothesisSidebar?(V(null,this._messagesElement),this._hypothesisSidebar.remove()):this.iframe.remove(),this._emitter.destroy(),un(null)}onFrameConnected(e,t){switch(e){case"guest":this._connectGuest(t);break
;case"sidebar":this._sidebarRPC.connect(t)}}_connectGuest(e){const t=new bn;t.on("textSelected",(()=>{this._guestWithSelection=t,this.toolbar.newAnnotationType="annotation",this._guestRPC.filter((e=>e!==t)).forEach((e=>e.call("clearSelection")))})),t.on("textUnselected",(()=>{this._guestWithSelection=null,this.toolbar.newAnnotationType="note",this._guestRPC.filter((e=>e!==t)).forEach((e=>e.call("clearSelection")))})),t.on("highlightsVisibleChanged",(e=>{this.setHighlightsVisible(e)}));const n=this.bucketBar;n&&t.on("anchorsChanged",(e=>{0===this._guestRPC.indexOf(t)&&n.update(e)})),t.on("close",(()=>{t.destroy(),t===this._guestWithSelection&&(this._guestWithSelection=null),this._guestRPC=this._guestRPC.filter((e=>e!==t))})),t.connect(e),this._guestRPC.push(t),t.call("sidebarLayoutChanged",this._layoutState)}_setupSidebarEvents(){var e;e=document.body,this._sidebarRPC.on("publicAnnotationCountChanged",(function(t){const n=e.querySelectorAll("[data-hypothesis-annotation-count]");Array.from(n).forEach((e=>{
e.textContent=t.toString()}))})),function(e,t){const n=e.querySelectorAll("[data-hypothesis-trigger]");Array.from(n).forEach((e=>{e.addEventListener("click",(e=>{t(),e.stopPropagation()}))}))}(document.body,(()=>this.open())),this._sidebarRPC.on("featureFlagsUpdated",(e=>this.features.update(e))),this._sidebarRPC.on("connect",(()=>{this.iframeContainer&&(this.iframeContainer.style.display="");const e="always"===this._config.showHighlights;this.setHighlightsVisible(e),(this._config.openSidebar||this._config.annotations||this._config.query||this._config.group)&&this.open()})),this._sidebarRPC.on("showHighlights",(()=>this.setHighlightsVisible(!0))),this._sidebarRPC.on("openSidebar",(()=>this.open())),this._sidebarRPC.on("closeSidebar",(()=>this.close())),this._sidebarRPC.on("openNotebook",(e=>{this.hide(),this._emitter.publish("openNotebook",e)})),this._sidebarRPC.on("openProfile",(()=>{this.hide(),this._emitter.publish("openProfile")})),this._emitter.subscribe("closeProfile",(()=>{this.show()})),
this._emitter.subscribe("closeNotebook",(()=>{this.show()})),this._sidebarRPC.on("toastMessageAdded",(e=>{this._emitter.publish("toastMessageAdded",e)})),this._sidebarRPC.on("toastMessageDismissed",(e=>{this._emitter.publish("toastMessageDismissed",e)}));[["loginRequested",this.onLoginRequest],["logoutRequested",this.onLogoutRequest],["signupRequested",this.onSignupRequest],["profileRequested",this.onProfileRequest],["helpRequested",this.onHelpRequest]].forEach((([e,t])=>{t&&this._sidebarRPC.on(e,(()=>t()))}))}_resetDragResizeState(){this._dragResizeState={initial:null,final:null}}_updateLayout(){this._renderFrame||(this._renderFrame=requestAnimationFrame((()=>{if(this._renderFrame=void 0,"number"==typeof this._dragResizeState.final&&this._dragResizeState.final!==this._dragResizeState.initial&&this.iframeContainer){const e=this._dragResizeState.final,t=-e;this.iframeContainer.style.marginLeft=`${e}px`,t>=280&&(this.iframeContainer.style.width=`${t}px`),this._updateLayoutState()}})))}_updateLayoutState(e){
const t=this.iframeContainer&&this.toolbar.getWidth()||0,n=this.iframeContainer??this.externalFrame,{height:o}=n.getBoundingClientRect(),i=window.getComputedStyle(n),r=parseInt(i.width),s=parseInt(i.marginLeft);let a=t;"boolean"==typeof e?e&&(a+=r):(s<280?a-=s:a+=r,e=a>t);const l={expanded:e,width:e?a:t,height:o,toolbarWidth:t};this._layoutState=l,this.onLayoutChange?.(l),this._guestRPC.forEach((e=>e.call("sidebarLayoutChanged",l)))}_onResize(){!0===this.toolbar.sidebarOpen&&(window.innerWidth<280?this.close():this.open())}isResizing(){return null!==this._dragResizeState.initial}_onDragSidebarToggleButton(e){const t=this.iframeContainer;if(t)switch(e.type){case"dragstart":this._resetDragResizeState(),t.classList.add("sidebar-no-transition"),t.style.pointerEvents="none",this._dragResizeState.initial=parseInt(getComputedStyle(t).marginLeft);break;case"dragend":t.classList.remove("sidebar-no-transition"),t.style.pointerEvents="",
null===this._dragResizeState.final||this._dragResizeState.final<=-280?this.open():this.close(),this._resetDragResizeState();break;case"dragmove":{if("number"!=typeof this._dragResizeState.initial)return;const t=this._dragResizeState.initial,n=e.deltaX;this._dragResizeState.final=Math.min(Math.round(t+n),0),this._updateLayout();break}}}open(){if(this._sidebarRPC.call("sidebarOpened"),this.iframeContainer){const e=this.iframeContainer.getBoundingClientRect().width;this.iframeContainer.style.marginLeft=-1*e+"px",this.iframeContainer.classList.remove("sidebar-collapsed")}this.toolbar.sidebarOpen=!0,"whenSidebarOpen"===this._config.showHighlights&&this.setHighlightsVisible(!0),this._updateLayoutState(!0)}close(){this._sidebarRPC.call("sidebarClosed"),this.iframeContainer&&(this.iframeContainer.style.marginLeft="",this.iframeContainer.classList.add("sidebar-collapsed")),this.toolbar.sidebarOpen=!1,"whenSidebarOpen"===this._config.showHighlights&&this.setHighlightsVisible(!1),this._updateLayoutState(!1)}
setHighlightsVisible(e){this.toolbar.highlightsVisible=e,this._sidebarRPC.call("setHighlightsVisible",e)}show(){this.iframeContainer?.classList.remove("is-hidden")}hide(){this.iframeContainer?.classList.add("is-hidden")}}class Xr{constructor(e){this._emitter=e,this._subscriptions=[]}publish(e,...t){this._emitter.emit(e,...t)}subscribe(e,t){this._emitter.on(e,t),this._subscriptions.push([e,t])}unsubscribe(e,t){this._emitter.off(e,t),this._subscriptions=this._subscriptions.filter((([n,o])=>n!==e||o!==t))}destroy(){for(const[e,t]of this._subscriptions)this._emitter.off(e,t);this._subscriptions=[]}}class Kr{constructor(){this._emitter=new an.TinyEmitter}createEmitter(){return new Xr(this._emitter)}}const Qr=document.querySelector('link[type="application/annotator+html"][rel="sidebar"]');new Promise((e=>{"loading"!==document.readyState&&e(),document.addEventListener("readystatechange",(()=>e()))})).then((function(){const e=$n("annotator");let t=()=>{};const n=new Promise((e=>{t=e}))
;Qr.addEventListener("destroy",t);const o=e.subFrameIdentifier?window.parent:window,i=[];if(o===window){if(function(){const e=document.querySelectorAll(["hypothesis-sidebar","hypothesis-notebook","hypothesis-profile"].join(","));return e.forEach((e=>e.remove())),e.length>0}())return void console.warn("Hypothesis did not load because it found an existing instance on the page.");const e=function(e=navigator.userAgent){if(!_n(e))return()=>{};const t=e=>{if("hypothesisPortClosed"===e.data?.type&&e.ports[0]){const t=e.ports[0];pn(t,"close"),t.close()}};return window.addEventListener("message",t),()=>window.removeEventListener("message",t)}();i.push({destroy:e});const t=$n("sidebar"),n=new URL(t.sidebarAppUrl).origin,o=new hn(n),r=new Kr,s=new jr(document.body,r,t),a=new Ir(document.body,r,$n("notebook")),l=new Fr(document.body,r,$n("profile"));o.on("frameConnected",((e,t)=>s.onFrameConnected(e,t))),i.push(o,s,a,l)}if("container"===fr()){const t=new mr(e);i.push(t)}else{
const n=new cr(document.body,e),r=new kr(document.body,e,o);r.on("hostDisconnected",t),i.push(n,r)}n.then((()=>{i.forEach((e=>e.destroy()));document.querySelectorAll("[data-hypothesis-asset]").forEach((e=>e.remove())),function(e=document){Array.from(e.querySelectorAll("script.js-hypothesis-config[data-remove-on-unload]")).forEach((e=>e.remove()))}()}))}))}();
//# sourceMappingURL=annotator.bundle.js.map
