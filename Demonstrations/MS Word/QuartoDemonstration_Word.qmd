---
title: '2022 Data Management Workshop: RMarkdown'
author: "Jason Ross & Jacob Cochran"
date: "`r format(Sys.time(), '%B %d %Y')`"
subtitle: Knit to Word Demonstration
format: 
  docx:
    toc: true
    reference-doc: word-styles-quarto.docx
editor: visual
---

```{r library}
#| echo: false
#| warning: false
#| include: false
library(tidyverse)
library(lubridate)
library(janitor)
library(kableExtra)
library(flextable)
#library(ymlthis)
```

# Introduction

This document demonstrates how to render a Word document using **RMarkdown** ([RMarkdown Cheat Sheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf)) and provides a few helpful links. Rendering a Word document can be challenging to format in R, especially when trying to format a table. Unlike rendering a PDF where you can format the document in the R script, it is better to format a reference document that can be used to format the document you are rendering ([Formating a Word document article](https://rmarkdown.rstudio.com/articles_docx.html)). We will step through the process to generate and use the reference document today. For more complex documents, I would recommend checking out the following packages:

Other packages that may help you:

1.  [Bookdown](https://bookdown.org/)
2.  [officedown](https://ardata-fr.github.io/flextable-book/index.html)

# Tables

There are a few packages that can handle tables in word with varying capabilities. The kableExtra package (@tbl-effortSiteskbl) can be used for simple tables while the huxtable package uses the flextable package. Therefore, the flextable package (@tbl-effortSitesflex) is best suited for formatting a table when rendering a document to word. Here are a few links that are helpful when using the flextable package:

-   Flextable Resources:
    -   <https://ardata-fr.github.io/flextable-book/>
    -   <https://davidgohel.github.io/flextable/reference/index.html>

## Kable Package

```{r DataImport}
#| echo: false
#| warning: false
#| include: false
## Import the effort and catch tables used for the summaries in this report
Effort <- read_csv("C:/Users/jross/OneDrive - DOI/Documents/Data Management/2022 R Markdown Training/Effort_Example.csv")
Catch <- read_csv("C:/Users/jross/OneDrive - DOI/Documents/Data Management/2022 R Markdown Training/Catch_Example.csv")

#

```

```{r EffortSummary}
#| echo: false
#| warning: false
#| label: tbl-effortSiteskbl
#| tbl-cap: "This is a nice table using the kableExtra package."

# Summarize data of effort by gear and year
EffortSum<- Effort %>%
 group_by(Year,Gear) %>%
 count() %>%
 pivot_wider(names_from = Gear, values_from = n) %>%
 as_tibble() 

## Creates a table using kable
kableExtra::kable(EffortSum, format="simple", align = 'lccc')

```

## Flextable Package

```{r EffortSummaryFlextable}
#| echo: false
#| warning: false
#| label: tbl-effortSitesflex
#| tbl-cap: "This is a nice table using the flextable package."

## Set the defaults for flextable
#set_flextable_defaults(font.size = 10, padding = 3,theme_fun = theme_vanilla,layout = "autofit")
## Tell R to use the df printer as data.frame print method for the document 
#use_df_printer()

### Summarizes data to create the effort summary table
EffortFlex<- Effort %>% 
 mutate(Year=as.factor(Year)) %>% 
 group_by(Year,Gear) %>% 
 count() %>% 
 pivot_wider(names_from = Gear, values_from = n) %>% 
 rename(Electrofishing="Boat Electroshocker", Bottom_Trawl="16' Bottom Trawl (4.9 m)") %>% 
 adorn_totals(where = "col") 

## Converts dataframe to a flextable and format the table
EffortTable<- flextable(EffortFlex) %>%
  color(~Bottom_Trawl>=121, j=2,i=, color="red") %>% #Change values in column 2(j) if values in Bottom_Trawl >121%>%  
  width(width=1.1) %>% #Each column is 1.1 inches wide
  align(align = "center",part = "all") %>%
  bold(j=ncol(EffortFlex))

## Print flextable
EffortTable
```
